<!DOCTYPE html>
<html><head>
  <title>TamWiki | Technology / How to remove duplicates in a hash in Ruby on Rails? - Stack Overflow</title>
  <link rel='stylesheet' href='http://wiki.tamouse.org/pub/skins/print/print.css' type='text/css' />
</head>
<body>
<!--PageText-->
<div id='wikitext'>
<h3><a class='external' href='http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails' target='_blank'>How to remove duplicates in a hash in Ruby on Rails?</a></h3>
<p>I have a hash like so:
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock1'>
  <div class='sourceblocktext'><div class="ruby"><ol><li class="li1"><div class="de1"><span class="br0">&#91;</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:lname</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;Brown&quot;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:email</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;james@intuit.com&quot;</span>,</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="re3">:fname</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;James&quot;</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:lname</span> <span class="sy0">=&gt;</span> <span class="kw2">nil</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:email</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;brad@intuit.com&quot;</span>,</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="re3">:fname</span> <span class="sy0">=&gt;</span> <span class="kw2">nil</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:lname</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;Smith&quot;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:email</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;brad@intuit.com&quot;</span>,</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="re3">:fname</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;Brad&quot;</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:lname</span> <span class="sy0">=&gt;</span> <span class="kw2">nil</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:email</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;brad@intuit.com&quot;</span>,</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="re3">:fname</span> <span class="sy0">=&gt;</span> <span class="kw2">nil</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:lname</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;Smith&quot;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:email</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;brad@intuit.com&quot;</span>,</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="re3">:fname</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;Brad&quot;</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:lname</span> <span class="sy0">=&gt;</span> <span class="kw2">nil</span>,</div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="re3">:email</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;brad@intuit.com&quot;</span>,</div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="re3">:fname</span> <span class="sy0">=&gt;</span> <span class="kw2">nil</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#93;</span></div></li>
</ol></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=1' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>What I would like to learn how to do is how to remove a record if it
is duplicate. Meaning, see how there are several "brad@intuit.com" how
can I remove the duplicate records, meaning remove all the others that
have an email of "brad@intuit.com".... Making email the key not the
other fields?
</p>
<p class='vspace'>I know this is an old thread, but Rails has a method on 'Enumerable' called 'index_by' which can be handy in this case:
</p>
<p class='vspace'>Now you can get the unique rows as follows:
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock2'>
  <div class='sourceblocktext'><div class="ruby">list.<span class="me1">index_by</span> <span class="br0">&#123;</span><span class="sy0">|</span>r<span class="sy0">|</span> r<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.<span class="me1">values</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=2' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>To merge the rows with the same email id.
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock3'>
  <div class='sourceblocktext'><div class="ruby">list.<span class="me1">group_by</span><span class="br0">&#123;</span><span class="sy0">|</span>r<span class="sy0">|</span> r<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span><span class="br0">&#125;</span>.<span class="me1">map</span> <span class="kw1">do</span> <span class="sy0">|</span>k, v<span class="sy0">|</span> v.<span class="me1">inject</span><span class="br0">&#40;</span><span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="sy0">|</span>r, h<span class="sy0">|</span> r.<span class="me1">merge</span><span class="br0">&#40;</span>h<span class="br0">&#41;</span><span class="br0">&#123;</span> <span class="sy0">|</span>key, o, n<span class="sy0">|</span> o <span class="sy0">||</span> n <span class="br0">&#125;</span> <span class="br0">&#125;</span> <span class="kw1">end</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=3' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>Custom but efficient method:
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock4'>
  <div class='sourceblocktext'><div class="ruby">list.<span class="me1">inject</span><span class="br0">&#40;</span><span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span> <span class="kw1">do</span> <span class="sy0">|</span>r, h<span class="sy0">|</span> <span class="br0">&#40;</span>r<span class="br0">&#91;</span>h<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="sy0">||</span>= <span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span>.<span class="me1">merge</span>!<span class="br0">&#40;</span>h<span class="br0">&#41;</span><span class="br0">&#123;</span> <span class="sy0">|</span>key, old, new<span class="sy0">|</span> old <span class="sy0">||</span> new <span class="br0">&#125;</span> &nbsp;r <span class="kw1">end</span>.<span class="me1">values</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=4' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>answered Mar 15 '11 at 18:39 <a class='external' href='http://stackoverflow.com:80/users/163203/harish-shetty' target='_blank'>Harish Shetty</a>
</p>
<p class='vspace'>In Ruby 1.9.2, <code>Array#uniq</code> will accept a block parameter which it
will use when comparing your objects:
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock5'>
  <div class='sourceblocktext'><div class="ruby">arrays.<span class="me1">uniq</span> <span class="br0">&#123;</span> <span class="sy0">|</span>h<span class="sy0">|</span> h<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> <span class="br0">&#125;</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=5' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'><a class='external' href='http://stackoverflow.com:80/users/190985/dan-cheail' target='_blank'>Dan Cheail</a>
</p>
<p class='vspace'>Ok, this (delete duplicates) is what you asked for:
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock6'>
  <div class='sourceblocktext'><div class="ruby">a.<span class="me1">sort_by</span> <span class="br0">&#123;</span> <span class="sy0">|</span>e<span class="sy0">|</span> e<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>.<span class="me1">inject</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="sy0">|</span>m,e<span class="sy0">|</span> m.<span class="me1">last</span>.<span class="kw2">nil</span>? ? <span class="br0">&#91;</span>e<span class="br0">&#93;</span> : m.<span class="me1">last</span><span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> == e<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> ? m : m <span class="sy0">&amp;</span>lt;<span class="sy0">&amp;</span>lt; e <span class="br0">&#125;</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=6' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>But I think this (merge values) is what you want:
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock7'>
  <div class='sourceblocktext'><div class="ruby">a.<span class="me1">sort_by</span> <span class="br0">&#123;</span> <span class="sy0">|</span>e<span class="sy0">|</span> e<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>.<span class="me1">inject</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="sy0">|</span>m,e<span class="sy0">|</span> m.<span class="me1">last</span>.<span class="kw2">nil</span>? ? <span class="br0">&#91;</span>e<span class="br0">&#93;</span> : m.<span class="me1">last</span><span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> == e<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> ? <span class="br0">&#40;</span>m.<span class="me1">last</span>.<span class="me1">merge</span>!<span class="br0">&#40;</span>e<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="sy0">|</span>k,o,n<span class="sy0">|</span> o &nbsp;n <span class="br0">&#125;</span>; m<span class="br0">&#41;</span> : m <span class="sy0">&amp;</span>lt;<span class="sy0">&amp;</span>lt; e <span class="br0">&#125;</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=7' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>Perhaps I'm stretching the one-liner idea a bit unreasonably, so with
different formatting and a test case: 
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock8'>
  <div class='sourceblocktext'><div class="ruby"><div class="head">mergedups</div><span class="kw3">require</span> <span class="st0">'pp'</span><br />
<br />
a = <span class="br0">&#91;</span><span class="br0">&#123;</span>:fname<span class="sy0">=&gt;</span><span class="st0">&quot;James&quot;</span>, <span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Brown&quot;</span>, <span class="re3">:email</span><span class="sy0">=&gt;</span><span class="st0">&quot;james@intuit.com&quot;</span><span class="br0">&#125;</span>,<br />
&nbsp; &nbsp; &nbsp;<span class="br0">&#123;</span>:fname<span class="sy0">=&gt;</span><span class="kw2">nil</span>, &nbsp; &nbsp; <span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="kw2">nil</span>, &nbsp; &nbsp; <span class="re3">:email</span><span class="sy0">=&gt;</span><span class="st0">&quot;brad@intuit.com&quot;</span><span class="br0">&#125;</span>,<br />
&nbsp; &nbsp; &nbsp;<span class="br0">&#123;</span>:fname<span class="sy0">=&gt;</span><span class="st0">&quot;Brad&quot;</span>, &nbsp;<span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Smith&quot;</span>, <span class="re3">:email</span><span class="sy0">=&gt;</span><span class="st0">&quot;brad@intuit.com&quot;</span><span class="br0">&#125;</span>,<br />
&nbsp; &nbsp; &nbsp;<span class="br0">&#123;</span>:fname<span class="sy0">=&gt;</span><span class="kw2">nil</span>, &nbsp; &nbsp; <span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="kw2">nil</span>, &nbsp; &nbsp; <span class="re3">:email</span><span class="sy0">=&gt;</span><span class="st0">&quot;brad@intuit.com&quot;</span><span class="br0">&#125;</span>,<br />
&nbsp; &nbsp; &nbsp;<span class="br0">&#123;</span>:fname<span class="sy0">=&gt;</span><span class="st0">&quot;Brad&quot;</span>, &nbsp;<span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Smith&quot;</span>, <span class="re3">:email</span><span class="sy0">=&gt;</span><span class="st0">&quot;brad@intuit.com&quot;</span><span class="br0">&#125;</span>,<br />
&nbsp; &nbsp; &nbsp;<span class="br0">&#123;</span>:fname<span class="sy0">=&gt;</span><span class="st0">&quot;Brad&quot;</span>, &nbsp;<span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Smith&quot;</span>, <span class="re3">:email</span><span class="sy0">=&gt;</span><span class="st0">&quot;brad@intuit.com&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><br />
<br />
pp<span class="br0">&#40;</span><br />
&nbsp; a.<span class="me1">sort_by</span> <span class="br0">&#123;</span> <span class="sy0">|</span>e<span class="sy0">|</span> e<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>.<span class="me1">inject</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="kw1">do</span> <span class="sy0">|</span>m,e<span class="sy0">|</span><br />
&nbsp; &nbsp; m.<span class="me1">last</span>.<span class="kw2">nil</span>? ? <span class="br0">&#91;</span>e<span class="br0">&#93;</span> :<br />
&nbsp; &nbsp; &nbsp; m.<span class="me1">last</span><span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> == e<span class="br0">&#91;</span><span class="re3">:email</span><span class="br0">&#93;</span> ? <span class="br0">&#40;</span>m.<span class="me1">last</span>.<span class="me1">merge</span>!<span class="br0">&#40;</span>e<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="sy0">|</span>k,o,n<span class="sy0">|</span> o <span class="sy0">||</span> n <span class="br0">&#125;</span>; m<span class="br0">&#41;</span> :<br />
&nbsp; &nbsp; &nbsp; &nbsp; m <span class="sy0">&lt;&lt;</span> e<br />
&nbsp; <span class="kw1">end</span><br />
<span class="br0">&#41;</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=8' type='text/plain'>raw code</a></div>
</div>

<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock9'>
  <div class='sourceblocktext'><div class="ruby"><div class="head">output</div><span class="br0">&#91;</span><span class="br0">&#123;</span>:email<span class="sy0">=&gt;</span><span class="st0">&quot;brad@intuit.com&quot;</span>, <span class="re3">:fname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Brad&quot;</span>, <span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Smith&quot;</span><span class="br0">&#125;</span>,<br />
&nbsp;<span class="br0">&#123;</span>:email<span class="sy0">=&gt;</span><span class="st0">&quot;james@intuit.com&quot;</span>, <span class="re3">:fname</span><span class="sy0">=&gt;</span><span class="st0">&quot;James&quot;</span>, <span class="re3">:lname</span><span class="sy0">=&gt;</span><span class="st0">&quot;Brown&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841?action=sourceblock&amp;num=9' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>answered Mar 6 '11 at 3:26 <a class='external' href='http://stackoverflow.com:80/users/140740/digitalross' target='_blank'>DigitalRoss</a>
</p>
<div class='vspace'></div><div  style='display: none;' > 
<p>Summary: a few ways to removing records with duplicate values residing in a hash, or merging records with duplicate values
Tags: saved page, ruby, hash, duplicate values
Source: <a class='external' href='http://stackoverflow.com/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails' target='_blank'>http://stackoverflow.com/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails</a>
Parent: (Technology.)Ruby
includeme: <a class='wikilink' href='http://wiki.tamouse.org?n=Technology.Ruby?action=print'>Technology.Ruby</a>
Categories:<a class='categorylink' href='http://wiki.tamouse.org?n=Category.Articles'>Articles</a>, <a class='categorylink' href='http://wiki.tamouse.org?n=Category.HowTos'>HowTos</a>
</p></div>
<p class='vspace'>Page saved at: Wed, 24 Jul 2013 03:08:41 -0500
</p>
<div class='vspace'></div>
</div>

</body>
</html>
