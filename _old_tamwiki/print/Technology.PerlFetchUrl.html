<!DOCTYPE html>
<html><head>
  <title>TamWiki | Technology / PerlFetchUrl</title>
  <link rel='stylesheet' href='http://wiki.tamouse.org/pub/skins/print/print.css' type='text/css' />
</head>
<body>
<!--PageText-->
<div id='wikitext'>
<p><a name='excerpt' id='excerpt'></a>
Fetching a page from the web is something which is done very often in my scripts. The following small function makes use of LWP::UserAgent to retrieve and return the HTTP::Response object from the call.
<a name='excerptend' id='excerptend'></a>
</p>
<div class='vspace'></div>
<div class='sourceblock ' id='sourceblock1'>
  <div class='sourceblocktext'><div class="perl"><div class="head">fetchURL function</div><ol><li class="li1"><div class="de1"><span class="kw2">sub</span> fetchUrl <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">my</span> <span class="re0">$url</span> <span class="sy0">=</span> <span class="kw3">shift</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">my</span> <span class="re0">$ua</span> <span class="sy0">=</span> LWP<span class="sy0">::</span><span class="me2">UserAgent</span><span class="sy0">-&gt;</span><span class="kw2">new</span><span class="br0">&#40;</span></div></li>
<li class="li1 ln-xtra"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; agent <span class="sy0">=&gt;</span> <span class="st0">&quot;Mozilla/5.0&quot;</span><span class="sy0">,</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; &nbsp; timeout <span class="sy0">=&gt;</span> <span class="nu0">30</span><span class="sy0">,</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">my</span> <span class="re0">$response</span> <span class="sy0">=</span> <span class="re0">$ua</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="re0">$url</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">unless</span> <span class="br0">&#40;</span><span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">is_success</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3">warn</span> <span class="st0">&quot;fetchUrl: $url&quot;</span> <span class="sy0">.</span> <span class="st_h">' returned '</span> <span class="sy0">.</span> <span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">status_line</span><span class="sy0">;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3">return</span> <span class="kw3">undef</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw3">return</span> <span class="re0">$response</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li>
</ol></div></div>
  <div class='sourceblocklink'><a href='http://wiki.tamouse.org?n=Technology.PerlFetchUrl?action=sourceblock&amp;num=1' type='text/plain'>raw code</a></div>
</div>

<p class='vspace'>Note at line 4, setting the value of the agent option. This is due to the practice of many websites not processing an unrecognized user agent string, or one which is quite obviously a script. This encapsulates the functionality inherent in LWP::<span class='wikiword'><a class='createlinktext' rel='nofollow'
    href='http://wiki.tamouse.org?n=Technology.UserAgent?action=edit'>UserAgent</a><a rel='nofollow' 
    class='createlink' href='http://wiki.tamouse.org?n=Technology.UserAgent?action=edit'>?</a></span>.
</p>
<p class='vspace'>This should properly be done as an extended class of LWP::<span class='wikiword'><a class='createlinktext' rel='nofollow'
    href='http://wiki.tamouse.org?n=Technology.UserAgent?action=edit'>UserAgent</a><a rel='nofollow' 
    class='createlink' href='http://wiki.tamouse.org?n=Technology.UserAgent?action=edit'>?</a></span>, but it is so straight-forward as procedural code.
</p>
<div class='vspace'></div><div  style='display: none;' > 
<p>Summary:A compact function to return an HTML page encapsulated in an HTTP::Response object
Parent:(Technology.)Perl
<span class='wikiword'><a class='createlinktext' rel='nofollow'
    href='http://wiki.tamouse.org?n=Technology.IncludeMe?action=edit'>IncludeMe</a><a rel='nofollow' 
    class='createlink' href='http://wiki.tamouse.org?n=Technology.IncludeMe?action=edit'>?</a></span>:<a class='wikilink' href='http://wiki.tamouse.org?n=Technology.Perl?action=print'>Technology.Perl</a>
Categories:<a class='categorylink' href='http://wiki.tamouse.org?n=Category.HowTos'>HowTos</a>
Tags: perl, howtos, examples, web development
</p></div>
<div class='vspace'></div>
</div>

</body>
</html>
