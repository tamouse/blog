version=pmwiki-2.2.43 ordered=1 urlencoded=1
agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.94 Safari/537.4
author=tamara
charset=ISO-8859-1
csum=update second portion to trigger where clause only if there are where parts 
ctime=1288627647
host=75.144.38.217
name=Technology.BestPracticeForBuildingSQLQueries
rev=15
targets=Technology.BestPracticeForBuildingSQLQueries,Technology.FlexibleQueryFunctions,Technology.PHP,Technology.IncludeMe,Category.Articles,Category.BestPractices,Category.HowTos
text=[[#excerpt]]%0aWriting and maintaining SQL queries can become rather tiresome. I've found the best way to write queries is to build them programmatically, placing each element in an array and then joining the array with whatever appropriate separator is needed.%0a[[#excerptend]]%0a%0a(See also: FlexibleQueryFunctions)%0a%0aHere's an example:%0a%0a(:source lang=php linenum :)%0a%3c?php%0a$csj_columns[] = 'c.`id`';%0a$csj_columns[] = 'c.`subscription_id`';%0a$csj_columns[] = 's.`name`';%0a$csj_columns[] = 's.`uri`';%0a$csj_columns[] = 'c.`imgsrc`';%0a$csj_columns[] = 'c.`filespec`';%0a$csj_columns[] = 'c.`comicdate`';%0a$csj_columns[] = 'c.`pulltime`';%0a%0a$from_parts[] = COMICSTBL.' as c';%0a$from_parts[] = SUBSCRIPTIONSTBL.' as s';%0a%0a$where_parts[] = 'c.`id`= ? '; // for use in a prepared statement%0a$where_parts[] = 'c.`subscription_id`=s.`id`';%0a%0a$sql[] = "SELECT";%0a$sql[] = join(', ', $csj_columns);%0a$sql[] = 'FROM';%0a$sql[] = join(', ', $from_parts);%0a$sql[] = 'WHERE';%0a$sql[] = join(" AND ",$where_parts);%0a$sql[] = 'LIMIT 1';%0a%0a$sql_s = join(" ",$sql);%0a?>%0a(:sourceend:)%0a%0aYou can see how the select columns and the where clause were put together in an array by pushing the individual column definittions, and then joining them with a ', ' separator. The resulting SQL statement looks like this:%0a%0a(:source lang=sql -getcode:)%0aSELECT c.`id`, c.`subscription_id`, s.`name`, s.`uri`, c.`imgsrc`, c.`filespec`, c.`comicdate`, c.`pulltime` FROM cg_comics as c, cg_subscriptions as s WHERE c.`id`= ? AND c.`subscription_id`=s.`id` LIMIT 1%0a(:sourceend:)%0a%0aUsing a single, multidimensional array for the parts of the statement might make a more interesting approach.%0a%0a(:source lang=php linenum:)%0a%3c?php%0a$stmt_a['columns'][] = 'c.`id`';%0a$stmt_a['columns'][] = 'c.`subscription_id`';%0a$stmt_a['columns'][] = 's.`name`';%0a$stmt_a['columns'][] = 's.`uri`';%0a$stmt_a['columns'][] = 'c.`imgsrc`';%0a$stmt_a['columns'][] = 'c.`filespec`';%0a$stmt_a['columns'][] = 'c.`comicdate`';%0a$stmt_a['columns'][] = 'c.`pulltime`';%0a%0a$stmt_a['from'][] = COMICSTBL.' as c';%0a$stmt_a['from'][] = SUBSCRIPTIONSTBL.' as s';%0a%0a$stmt_a['where'][] = 'c.`id`= ? '; // for use in a prepared statement%0a$stmt_a['where'][] = 'c.`subscription_id`=s.`id`';%0a%0a$sql[] = "SELECT";%0a$sql[] = join(', ', $stmt_a['columns']);%0a$sql[] = 'FROM';%0a$sql[] = join(', ', $stmt_a['from']);%0aif (array_key_exists('where',$stmt_a)) {%0a  $sql[] = 'WHERE';%0a  $sql[] = join(" AND ",$stmt_a['where']);%0a}%0a%0a$sql_s = join(" ",$sql);%0a?>%0a(:sourceend:)%0a%0aand obviously, you can go on from there adding SQL query statement parts.%0a%0a(:if false:)%0aSummary:a set of practices for building SQL queries in PHP%0aParent:(Technology.)PHP%0aIncludeMe:[[Technology.PHP]]%0aCategories:[[!Articles]], [[!BestPractices]], [[!HowTos]]%0aTags: php, sql, how to, web development%0a(:tags-hide php, sql, how to, web development :)%0a(:ifend:)%0a%0a%0a
time=1352134782
author:1352134782=tamara
csum:1352134782=update second portion to trigger where clause only if there are where parts 
diff:1352134782:1332303005:=67,70c67,68%0a%3c if (array_key_exists('where',$stmt_a)) {%0a%3c   $sql[] = 'WHERE';%0a%3c   $sql[] = join(" AND ",$stmt_a['where']);%0a%3c }%0a---%0a> $sql[] = 'WHERE';%0a> $sql[] = join(" AND ",$stmt_a['where']);%0a
host:1352134782=75.144.38.217
author:1332303005=tamara
csum:1332303005=add categories
diff:1332303005:1332302923:minor=80c80%0a%3c Categories:[[!Articles]], [[!BestPractices]], [[!HowTos]]%0a---%0a> Categories:[[!Articles]%0a
host:1332303005=71.63.211.0
author:1332302923=tamara
csum:1332302923=move page from main, add a new example using a multidimensional array
diff:1332302923:1332301474:=1c1,10%0a%3c [[#excerpt]]%0a---%0a> (:Summary:A set of practices for building SQL Queries in PHP:)%0a> [[%3c%3c]]%0a> %3c%3c|SoftwareAndWebProgramming|>>%0a> [[%3c%3c]]%0a> %3c%3c|[[PHP]]|>>%0a> %0a> %25em%25Tags: %25%25 (:tags php, sql, source code, coding examples, web development:)%0a> %0a> (See also: FlexibleQueryFunctions)%0a> %0a3,6c12%0a%3c [[#excerptend]]%0a%3c %0a%3c (See also: FlexibleQueryFunctions)%0a%3c %0a---%0a> %0a9,10c15%0a%3c (:source lang=php linenum :)%0a%3c %3c?php%0a---%0a> (:source lang=php linenum :) [@ %3c?php%0a23c28%0a%3c $where_parts[] = 'c.`id`= ? '; // for use in a prepared statement%0a---%0a> $where_parts[] = 'c.`id`=' . $comic_id;%0a35a41,46%0a> @]%0a> %0a> You'll see how the select columns and the where clause were put together in an array by pushing the individual column definittions, and then joining them with a ', ' separator. The resulting SQL statement looks like this:%0a> %0a> (:source lang=sql -trim -getcode:)%0a>  SELECT c.`id`, c.`subscription_id`, s.`name`, s.`uri`, c.`imgsrc`, c.`filespec`, c.`comicdate`, c.`pulltime` FROM cg_comics as c, cg_subscriptions as s WHERE c.`id`=1 AND c.`subscription_id`=s.`id` LIMIT 1%0a38,85c49,52%0a%3c You can see how the select columns and the where clause were put together in an array by pushing the individual column definittions, and then joining them with a ', ' separator. The resulting SQL statement looks like this:%0a%3c %0a%3c (:source lang=sql -getcode:)%0a%3c SELECT c.`id`, c.`subscription_id`, s.`name`, s.`uri`, c.`imgsrc`, c.`filespec`, c.`comicdate`, c.`pulltime` FROM cg_comics as c, cg_subscriptions as s WHERE c.`id`= ? AND c.`subscription_id`=s.`id` LIMIT 1%0a%3c (:sourceend:)%0a%3c %0a%3c Using a single, multidimensional array for the parts of the statement might make a more interesting approach.%0a%3c %0a%3c (:source lang=php linenum:)%0a%3c %3c?php%0a%3c $stmt_a['columns'][] = 'c.`id`';%0a%3c $stmt_a['columns'][] = 'c.`subscription_id`';%0a%3c $stmt_a['columns'][] = 's.`name`';%0a%3c $stmt_a['columns'][] = 's.`uri`';%0a%3c $stmt_a['columns'][] = 'c.`imgsrc`';%0a%3c $stmt_a['columns'][] = 'c.`filespec`';%0a%3c $stmt_a['columns'][] = 'c.`comicdate`';%0a%3c $stmt_a['columns'][] = 'c.`pulltime`';%0a%3c %0a%3c $stmt_a['from'][] = COMICSTBL.' as c';%0a%3c $stmt_a['from'][] = SUBSCRIPTIONSTBL.' as s';%0a%3c %0a%3c $stmt_a['where'][] = 'c.`id`= ? '; // for use in a prepared statement%0a%3c $stmt_a['where'][] = 'c.`subscription_id`=s.`id`';%0a%3c %0a%3c $sql[] = "SELECT";%0a%3c $sql[] = join(', ', $stmt_a['columns']);%0a%3c $sql[] = 'FROM';%0a%3c $sql[] = join(', ', $stmt_a['from']);%0a%3c $sql[] = 'WHERE';%0a%3c $sql[] = join(" AND ",$stmt_a['where']);%0a%3c %0a%3c $sql_s = join(" ",$sql);%0a%3c ?>%0a%3c (:sourceend:)%0a%3c %0a%3c and obviously, you can go on from there adding SQL query statement parts.%0a%3c %0a%3c (:if false:)%0a%3c Summary:a set of practices for building SQL queries in PHP%0a%3c Parent:(Technology.)PHP%0a%3c IncludeMe:[[Technology.PHP]]%0a%3c Categories:[[!Articles]%0a%3c Tags: php, sql, how to, web development%0a%3c (:tags-hide php, sql, how to, web development :)%0a%3c (:ifend:)%0a%3c %0a%3c %0a---%0a> %0a> %0a> %0a> %25rframe%25 '''Categories:''' [[!ComputerStuff]]%0a
host:1332302923=71.63.211.0
author:1332301474=tamara
csum:1332301474=Page moved to Technology.BestPracticeForBuildingSQLQueries from Main.BestPracticeForBuildingSQLQueries
diff:1332301474:1289637547:=
host:1332301474=71.63.211.0
author:1289637547=tamara
csum:1289637547=remove echo line from end of code, cleanup source parameters
diff:1289637547:1288649673:minor=15c15%0a%3c (:source lang=php linenum :) [@ %3c?php%0a---%0a> (:source lang=php linenum tabwidth=4 -trim +getcode :) [@ %3c?php%0a39a40%0a> echo $sql_s."\n";%0a
host:1289637547=71.63.211.0
author:1288649673=tamara
diff:1288649673:1288631019:=8,9d7%0a%3c %0a%3c (See also: FlexibleQueryFunctions)%0a
host:1288649673=71.63.211.0
author:1288631019=tamara
diff:1288631019:1288630983:=7c7%0a%3c %25em%25Tags: %25%25 (:tags php, sql, source code, coding examples, web development:)%0a---%0a> (:tags php, sql, source code, coding examples, web development:)%0a
host:1288631019=71.63.211.0
author:1288630983=tamara
diff:1288630983:1288630054:=6,7d5%0a%3c %0a%3c (:tags php, sql, source code, coding examples, web development:)%0a
host:1288630983=71.63.211.0
author:1288630054=tamara
diff:1288630054:1288629954:=43c43%0a%3c  SELECT c.`id`, c.`subscription_id`, s.`name`, s.`uri`, c.`imgsrc`, c.`filespec`, c.`comicdate`, c.`pulltime` FROM cg_comics as c, cg_subscriptions as s WHERE c.`id`=1 AND c.`subscription_id`=s.`id` LIMIT 1%0a---%0a> SELECT c.id, c.subscription_id, s.name, s.uri, c.imgsrc, c.filespec, c.comicdate, c.pulltime FROM COMICSTBL as c, SUBSCRIPTIONSTBL as s  WHERE c.`id`= AND c.`subscription_id`=s.`id` GROUP BY s.`name`  LIMIT 1%0a
host:1288630054=71.63.211.0
author:1288629954=tamara
diff:1288629954:1288629715:=12,19c12,19%0a%3c $csj_columns[] = 'c.`id`';%0a%3c $csj_columns[] = 'c.`subscription_id`';%0a%3c $csj_columns[] = 's.`name`';%0a%3c $csj_columns[] = 's.`uri`';%0a%3c $csj_columns[] = 'c.`imgsrc`';%0a%3c $csj_columns[] = 'c.`filespec`';%0a%3c $csj_columns[] = 'c.`comicdate`';%0a%3c $csj_columns[] = 'c.`pulltime`';%0a---%0a> $csj_columns[] = 'c.id';%0a> $csj_columns[] = 'c.subscription_id';%0a> $csj_columns[] = 's.name';%0a> $csj_columns[] = 's.uri';%0a> $csj_columns[] = 'c.imgsrc';%0a> $csj_columns[] = 'c.filespec';%0a> $csj_columns[] = 'c.comicdate';%0a> $csj_columns[] = 'c.pulltime';%0a
host:1288629954=71.63.211.0
author:1288629715=tamara
diff:1288629715:1288629643:=29c29%0a%3c $sql[] = 'FROM';%0a---%0a> $sql[] = 'FROM'%0a31c31%0a%3c $sql[] = 'WHERE';%0a---%0a> $sql[] = ' WHERE ';%0a33c33%0a%3c $sql[] = 'LIMIT 1';%0a---%0a> $sql[] = " LIMIT 1";%0a
host:1288629715=71.63.211.0
author:1288629643=tamara
diff:1288629643:1288628313:=11,12c11%0a%3c (:source lang=php linenum tabwidth=4 -trim +getcode :) [@ %3c?php%0a%3c $csj_columns[] = 'c.id';%0a---%0a> (:source lang=php linenum tabwidth=4 -trim +getcode :) [@ $csj_columns[] = 'c.id';%0a21,37c20,34%0a%3c $from_parts[] = COMICSTBL.' as c';%0a%3c $from_parts[] = SUBSCRIPTIONSTBL.' as s';%0a%3c %0a%3c $where_parts[] = 'c.`id`=' . $comic_id;%0a%3c $where_parts[] = 'c.`subscription_id`=s.`id`';%0a%3c %0a%3c $sql[] = "SELECT";%0a%3c $sql[] = join(', ', $csj_columns);%0a%3c $sql[] = 'FROM'%0a%3c $sql[] = join(', ', $from_parts);%0a%3c $sql[] = ' WHERE ';%0a%3c $sql[] = join(" AND ",$where_parts);%0a%3c $sql[] = " LIMIT 1";%0a%3c %0a%3c $sql_s = join(" ",$sql);%0a%3c echo $sql_s."\n";%0a%3c ?>%0a---%0a> 	$sql 		= "SELECT ";%0a> 	$sql 		.= join(', ', $csj_columns);%0a> 	$sql 		.= ' FROM ' . COMICSTBL . ' as c, ' . SUBSCRIPTIONSTBL . ' as s ';%0a> 	$sql		.= ' WHERE ';%0a> 	$where_parts[] = 'c.`id`=' . $comic_id;%0a> 	$where_parts[] = 'c.`subscription_id`=s.`id`';%0a> 	$sql		.= join(" AND ",$where_parts);%0a> 	$sql		.= ' GROUP BY s.`name` ';%0a> 	$sql		.= " LIMIT 1";@]%0a> %0a> You'll see how the select columns were put together in an array by pushing the individual column definittions, and then joining them with a ', ' separator. The resulting SQL statement looks like this:%0a> %0a> (:source lang=sql -trim -getcode:) [@%0a> SELECT c.id, c.subscription_id, s.name, s.uri, c.imgsrc, c.filespec, c.comicdate, c.pulltime FROM COMICSTBL as c, SUBSCRIPTIONSTBL as s  WHERE c.`id`= AND c.`subscription_id`=s.`id` GROUP BY s.`name`  LIMIT 1%0a> %0a39,44d35%0a%3c %0a%3c You'll see how the select columns and the where clause were put together in an array by pushing the individual column definittions, and then joining them with a ', ' separator. The resulting SQL statement looks like this:%0a%3c %0a%3c (:source lang=sql -trim -getcode:)%0a%3c SELECT c.id, c.subscription_id, s.name, s.uri, c.imgsrc, c.filespec, c.comicdate, c.pulltime FROM COMICSTBL as c, SUBSCRIPTIONSTBL as s  WHERE c.`id`= AND c.`subscription_id`=s.`id` GROUP BY s.`name`  LIMIT 1%0a%3c (:sourceend:)%0a
host:1288629643=71.63.211.0
author:1288628313=tamara
diff:1288628313:1288627915:=11c11,13%0a%3c (:source lang=php linenum tabwidth=4 -trim +getcode :) [@ $csj_columns[] = 'c.id';%0a---%0a> (:source lang=php linenum tabwidth=4 -trim +getcode :) [@ %0a> %0a> $csj_columns[] = 'c.id';%0a19a22%0a> %0a28,29c31,34%0a%3c 	$sql		.= " LIMIT 1";@]%0a%3c %0a---%0a> 	$sql		.= " LIMIT 1";%0a> %0a> @]%0a> %0a32,33c37%0a%3c (:source lang=sql -trim -getcode:) [@%0a%3c SELECT c.id, c.subscription_id, s.name, s.uri, c.imgsrc, c.filespec, c.comicdate, c.pulltime FROM COMICSTBL as c, SUBSCRIPTIONSTBL as s  WHERE c.`id`= AND c.`subscription_id`=s.`id` GROUP BY s.`name`  LIMIT 1%0a---%0a> (:source lang=sql -trim:) [@%0a
host:1288628313=71.63.211.0
author:1288627915=tamara
diff:1288627915:1288627647:=34,40d33%0a%3c %0a%3c You'll see how the select columns were put together in an array by pushing the individual column definittions, and then joining them with a ', ' separator. The resulting SQL statement looks like this:%0a%3c %0a%3c (:source lang=sql -trim:) [@%0a%3c %0a%3c @]%0a%3c %0a
host:1288627915=71.63.211.0
author:1288627647=tamara
diff:1288627647:1288627647:=1,37d0%0a%3c (:Summary:A set of practices for building SQL Queries in PHP:)%0a%3c [[%3c%3c]]%0a%3c %3c%3c|SoftwareAndWebProgramming|>>%0a%3c [[%3c%3c]]%0a%3c %3c%3c|[[PHP]]|>>%0a%3c %0a%3c Writing and maintaining SQL queries can become rather tiresome. I've found the best way to write queries is to build them programmatically, placing each element in an array and then joining the array with whatever appropriate separator is needed.%0a%3c %0a%3c Here's an example:%0a%3c %0a%3c (:source lang=php linenum tabwidth=4 -trim +getcode :) [@ %0a%3c %0a%3c $csj_columns[] = 'c.id';%0a%3c $csj_columns[] = 'c.subscription_id';%0a%3c $csj_columns[] = 's.name';%0a%3c $csj_columns[] = 's.uri';%0a%3c $csj_columns[] = 'c.imgsrc';%0a%3c $csj_columns[] = 'c.filespec';%0a%3c $csj_columns[] = 'c.comicdate';%0a%3c $csj_columns[] = 'c.pulltime';%0a%3c %0a%3c %0a%3c 	$sql 		= "SELECT ";%0a%3c 	$sql 		.= join(', ', $csj_columns);%0a%3c 	$sql 		.= ' FROM ' . COMICSTBL . ' as c, ' . SUBSCRIPTIONSTBL . ' as s ';%0a%3c 	$sql		.= ' WHERE ';%0a%3c 	$where_parts[] = 'c.`id`=' . $comic_id;%0a%3c 	$where_parts[] = 'c.`subscription_id`=s.`id`';%0a%3c 	$sql		.= join(" AND ",$where_parts);%0a%3c 	$sql		.= ' GROUP BY s.`name` ';%0a%3c 	$sql		.= " LIMIT 1";%0a%3c %0a%3c @]%0a%3c %0a%3c %0a%3c %0a%3c %25rframe%25 '''Categories:''' [[!ComputerStuff]]%0a
host:1288627647=71.63.211.0
