version=pmwiki-2.2.43 ordered=1 urlencoded=1
agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.71 Safari/537.36
author=tamara
charset=ISO-8859-1
csum=Page moved to Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841
ctime=1374653349
host=71.63.215.130
name=SavedArticles.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841
rev=3
targets=
text=(:redirect Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841:)
time=1374654904
author:1374654904=tamara
csum:1374654904=Page moved to Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841
diff:1374654904:1374654889:=1c1,143%0a%3c (:redirect Technology.HowToRemoveDuplicatesInAHashInRubyOnRailsStackOverflow20130724030841:)%0a\ No newline at end of file%0a---%0a> (:nolinkwikiwords:)%0a> !!! [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | How to remove duplicates in a hash in Ruby on Rails?]]%0a> %0a> I have a hash like so:%0a> %0a> (:source lang=ruby linenum tabwidth=2  :)%0a> [%0a>   {%0a>     :lname => "Brown",%0a>     :email => "james@intuit.com",%0a>     :fname => "James"%0a>   },%0a>   {%0a>     :lname => nil,%0a>     :email => "brad@intuit.com",%0a>     :fname => nil%0a>   },%0a>   {%0a>     :lname => "Smith",%0a>     :email => "brad@intuit.com",%0a>     :fname => "Brad"%0a>   },%0a>   {%0a>     :lname => nil,%0a>     :email => "brad@intuit.com",%0a>     :fname => nil%0a>   },%0a>   {%0a>     :lname => "Smith",%0a>     :email => "brad@intuit.com",%0a>     :fname => "Brad"%0a>   },%0a>   {%0a>     :lname => nil,%0a>     :email => "brad@intuit.com",%0a>     :fname => nil%0a>   }%0a> ]%0a> (:sourceend:)%0a> %0a> %0a> What I would like to learn how to do is how to remove a record if it%0a> is duplicate. Meaning, see how there are several "brad@intuit.com" how%0a> can I remove the duplicate records, meaning remove all the others that%0a> have an email of "brad@intuit.com".... Making email the key not the%0a> other fields?%0a> %0a> %0a> %0a> I know this is an old thread, but Rails has a method on 'Enumerable' called 'index_by' which can be handy in this case:%0a> %0a> %0a> %0a> Now you can get the unique rows as follows:%0a> %0a> (:source lang=ruby    :)%0a> list.index_by {|r| r[:email]}.values%0a> (:sourceend:)%0a> %0a> To merge the rows with the same email id.%0a> %0a> %0a> (:source lang=ruby    :)%0a> list.group_by{|r| r[:email]}.map do |k, v| v.inject({}) {|r, h| r.merge(h){ |key, o, n| o || n } } end%0a> (:sourceend:)%0a> %0a> Custom but efficient method:%0a> %0a> (:source lang=ruby    :)%0a> list.inject({}) do |r, h| (r[h[:email]] ||= {}).merge!(h){ |key, old, new| old || new }  r end.values%0a> (:sourceend:)%0a> %0a> answered Mar 15 '11 at 18:39 [[http://stackoverflow.com:80/users/163203/harish-shetty | Harish Shetty]]%0a> %0a> %0a> %0a> In Ruby 1.9.2, @@Array#uniq@@ will accept a block parameter which it%0a> will use when comparing your objects:%0a> %0a> (:source lang=ruby    :)%0a> arrays.uniq { |h| h[:email] }%0a> (:sourceend:)%0a>   %0a> [[http://stackoverflow.com:80/users/190985/dan-cheail | Dan Cheail]]%0a> %0a> Ok, this (delete duplicates) is what you asked for:%0a> %0a> (:source lang=ruby    :)%0a> a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? m : m &lt;&lt; e }%0a> (:sourceend:)%0a> %0a> But I think this (merge values) is what you want:%0a> %0a> (:source lang=ruby    :)%0a> a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o  n }; m) : m &lt;&lt; e }%0a> (:sourceend:)%0a> %0a> Perhaps I'm stretching the one-liner idea a bit unreasonably, so with%0a> different formatting and a test case: %0a> %0a> (:source lang=ruby  tabwidth=2 header="mergedups" :)%0a> require 'pp'%0a> %0a> a = [{:fname=>"James", :lname=>"Brown", :email=>"james@intuit.com"},%0a>      {:fname=>nil,     :lname=>nil,     :email=>"brad@intuit.com"},%0a>      {:fname=>"Brad",  :lname=>"Smith", :email=>"brad@intuit.com"},%0a>      {:fname=>nil,     :lname=>nil,     :email=>"brad@intuit.com"},%0a>      {:fname=>"Brad",  :lname=>"Smith", :email=>"brad@intuit.com"},%0a>      {:fname=>"Brad",  :lname=>"Smith", :email=>"brad@intuit.com"}]%0a> %0a> pp(%0a>   a.sort_by { |e| e[:email] }.inject([]) do |m,e|%0a>     m.last.nil? ? [e] :%0a>       m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o || n }; m) :%0a>         m %3c%3c e%0a>   end%0a> )%0a> (:sourceend:)%0a> %0a> (:source lang=ruby   header="output" :)%0a> [{:email=>"brad@intuit.com", :fname=>"Brad", :lname=>"Smith"},%0a>  {:email=>"james@intuit.com", :fname=>"James", :lname=>"Brown"}]%0a> (:sourceend:)%0a> %0a> %0a>   %0a> answered Mar 6 '11 at 3:26 [[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]]%0a> %0a> (:linkwikiwords:)%0a> %0a> >>comment%3c%3c%0a> Summary: a few ways to removing records with duplicate values residing in a hash, or merging records with duplicate values%0a> Tags: saved page, ruby, hash, duplicate values%0a> (:tags-hide saved page, ruby, hash, duplicate values:)%0a> (:title How to remove duplicates in a hash in Ruby on Rails? - Stack Overflow:)%0a> Source: http://stackoverflow.com/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails%0a> Parent: (Technology.)Ruby%0a> includeme: [[Technology.Ruby]]%0a> Categories:[[!Articles]], [[!HowTos]]%0a> >>%3c%3c%0a> %0a> Page saved at: Wed, 24 Jul 2013 03:08:41 -0500%0a> %0a
host:1374654904=71.63.215.130
author:1374654889=tamara
csum:1374654889=reformatted for pmwiki
diff:1374654889:1374653349:=2,128c2,102%0a%3c !!! [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | How to remove duplicates in a hash in Ruby on Rails?]]%0a%3c %0a%3c I have a hash like so:%0a%3c %0a%3c (:source lang=ruby linenum tabwidth=2  :)%0a%3c [%0a%3c   {%0a%3c     :lname => "Brown",%0a%3c     :email => "james@intuit.com",%0a%3c     :fname => "James"%0a%3c   },%0a%3c   {%0a%3c     :lname => nil,%0a%3c     :email => "brad@intuit.com",%0a%3c     :fname => nil%0a%3c   },%0a%3c   {%0a%3c     :lname => "Smith",%0a%3c     :email => "brad@intuit.com",%0a%3c     :fname => "Brad"%0a%3c   },%0a%3c   {%0a%3c     :lname => nil,%0a%3c     :email => "brad@intuit.com",%0a%3c     :fname => nil%0a%3c   },%0a%3c   {%0a%3c     :lname => "Smith",%0a%3c     :email => "brad@intuit.com",%0a%3c     :fname => "Brad"%0a%3c   },%0a%3c   {%0a%3c     :lname => nil,%0a%3c     :email => "brad@intuit.com",%0a%3c     :fname => nil%0a%3c   }%0a%3c ]%0a%3c (:sourceend:)%0a%3c %0a%3c %0a%3c What I would like to learn how to do is how to remove a record if it%0a%3c is duplicate. Meaning, see how there are several "brad@intuit.com" how%0a%3c can I remove the duplicate records, meaning remove all the others that%0a%3c have an email of "brad@intuit.com".... Making email the key not the%0a%3c other fields?%0a%3c %0a%3c %0a%3c %0a%3c I know this is an old thread, but Rails has a method on 'Enumerable' called 'index_by' which can be handy in this case:%0a%3c %0a%3c %0a%3c %0a%3c Now you can get the unique rows as follows:%0a%3c %0a%3c (:source lang=ruby    :)%0a%3c list.index_by {|r| r[:email]}.values%0a%3c (:sourceend:)%0a%3c %0a%3c To merge the rows with the same email id.%0a%3c %0a%3c %0a%3c (:source lang=ruby    :)%0a%3c list.group_by{|r| r[:email]}.map do |k, v| v.inject({}) {|r, h| r.merge(h){ |key, o, n| o || n } } end%0a%3c (:sourceend:)%0a%3c %0a%3c Custom but efficient method:%0a%3c %0a%3c (:source lang=ruby    :)%0a%3c list.inject({}) do |r, h| (r[h[:email]] ||= {}).merge!(h){ |key, old, new| old || new }  r end.values%0a%3c (:sourceend:)%0a%3c %0a%3c answered Mar 15 '11 at 18:39 [[http://stackoverflow.com:80/users/163203/harish-shetty | Harish Shetty]]%0a%3c %0a%3c %0a%3c %0a%3c In Ruby 1.9.2, @@Array#uniq@@ will accept a block parameter which it%0a%3c will use when comparing your objects:%0a%3c %0a%3c (:source lang=ruby    :)%0a%3c arrays.uniq { |h| h[:email] }%0a%3c (:sourceend:)%0a%3c   %0a%3c [[http://stackoverflow.com:80/users/190985/dan-cheail | Dan Cheail]]%0a%3c %0a%3c Ok, this (delete duplicates) is what you asked for:%0a%3c %0a%3c (:source lang=ruby    :)%0a%3c a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? m : m &lt;&lt; e }%0a%3c (:sourceend:)%0a%3c %0a%3c But I think this (merge values) is what you want:%0a%3c %0a%3c (:source lang=ruby    :)%0a%3c a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o  n }; m) : m &lt;&lt; e }%0a%3c (:sourceend:)%0a%3c %0a%3c Perhaps I'm stretching the one-liner idea a bit unreasonably, so with%0a%3c different formatting and a test case: %0a%3c %0a%3c (:source lang=ruby  tabwidth=2 header="mergedups" :)%0a%3c require 'pp'%0a%3c %0a%3c a = [{:fname=>"James", :lname=>"Brown", :email=>"james@intuit.com"},%0a%3c      {:fname=>nil,     :lname=>nil,     :email=>"brad@intuit.com"},%0a%3c      {:fname=>"Brad",  :lname=>"Smith", :email=>"brad@intuit.com"},%0a%3c      {:fname=>nil,     :lname=>nil,     :email=>"brad@intuit.com"},%0a%3c      {:fname=>"Brad",  :lname=>"Smith", :email=>"brad@intuit.com"},%0a%3c      {:fname=>"Brad",  :lname=>"Smith", :email=>"brad@intuit.com"}]%0a%3c %0a%3c pp(%0a%3c   a.sort_by { |e| e[:email] }.inject([]) do |m,e|%0a%3c     m.last.nil? ? [e] :%0a%3c       m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o || n }; m) :%0a%3c         m %3c%3c e%0a%3c   end%0a%3c )%0a%3c (:sourceend:)%0a%3c %0a%3c (:source lang=ruby   header="output" :)%0a%3c [{:email=>"brad@intuit.com", :fname=>"Brad", :lname=>"Smith"},%0a%3c  {:email=>"james@intuit.com", :fname=>"James", :lname=>"Brown"}]%0a%3c (:sourceend:)%0a%3c %0a%3c %0a%3c   %0a%3c answered Mar 6 '11 at 3:26 [[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]]%0a%3c %0a---%0a> [[http://stackexchange.com | Stack Exchange]]  [[http://stackoverflow.com:80/users/login?returnurl=/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | sign up]] | [[http://stackoverflow.com:80/users/login?returnurl=/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | log in]] | [[http://careers.stackoverflow.com | careers 2.0]] |   \\%0a> [[http://stackoverflow.com:80/ |  Stack Overflow ]]%0a> %0a> * [[http://stackoverflow.com:80/questions | Questions]]%0a> * [[http://stackoverflow.com:80/tags | Tags]]%0a> * [[http://stackoverflow.com:80/about | Tour]]%0a> * [[http://stackoverflow.com:80/users | Users]]%0a> %0a> * [[http://stackoverflow.com:80/questions/ask | Ask Question]]%0a> %0a>  [[http://stackoverflow.com:80/about | Tell me more]] [[ | &times;]] Stack Overflow is a question and answer site for professional and enthusiast programmers. It's 100%25 free, no registration required.%0a> %0a> ! [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | How to remove duplicates in a hash in Ruby on Rails?]]%0a> %0a> ||%0a> ||[[ | up vote]] 4 [[ | down vote]] [[http://stackoverflow.com:80/# | favorite]]'''1''' ||I have a hash like so: @@[   {     :lname =&gt; "Brown",     :email =&gt; "james@intuit.com",     :fname =&gt; "James"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   } ]@@What I would like to learn how to do is how to remove a record if it is duplicate. Meaning, see how there are several "brad@intuit.com" how can I remove the duplicate records, meaning remove all the others that have an email of "brad@intuit.com".... Making email the key not the other fields?[[http://stackoverflow.com:80/questions/tagged/ruby-on-rails | ruby-on-rails]] [[http://stackoverflow.com:80/questions/tagged/ruby | ruby]] [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails-3 | ruby-on-rails-3]]||  ||[[http://stackoverflow.com:80/q/5208344 | share]]|[[http://stackoverflow.com:80/posts/5208344/edit | improve this question]] || [[http://stackoverflow.com:80/posts/5208344/revisions | edited Mar 15 '11 at 22:22]][[http://stackoverflow.com:80/users/38765/andrew-grimm | https://www.gravatar.com/avatar/01bbb59a1c3ef9960f25a97afe7e920f?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/38765/andrew-grimm | Andrew Grimm]] [[%3c%3c]] 17.6k950113||asked Mar 6 '11 at 2:54[[http://stackoverflow.com:80/users/149080/anapprentice | https://www.gravatar.com/avatar/685eca46bfebf9233cc276b415a74ddb?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] [[%3c%3c]] 11.3k31177419 || ||%0a> || ||||  ||||  ||2 || || ||Is the a pure Ruby hash or a hash that represents data actually in the database (say, via ActiveRecord)? &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 2:56 || ||||  ||1 || || ||why not put validates_uniqueness_of the email field? that way even if you get duplicate stuff in your params, it won't be saved. also put the necessary error catching when saving fails. &ndash;&nbsp;[[http://stackoverflow.com:80/users/334545/corroded | corroded]] Mar 6 '11 at 2:56 || || ||It's being created based on a CSV list, where users can input emails to invite friends &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 2:57 || || ||@Corroded, can't do that bec I need to take the input and then parse and display the output to the user. The above is after the input has been parsed. I just need to take it to the next level by removing duplicates. &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 2:58 || ||%0a> %0a> [[#tab-top]]%0a> %0a> !! 4 Answers%0a> %0a> [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails?answertab=active#tab-top | active]] [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails?answertab=oldest#tab-top | oldest]] [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails?answertab=votes#tab-top | votes]][[#5316407]]%0a> %0a> ||%0a> ||[[ | up vote]] 6 [[ | down vote]] accepted ||I know this is an old thread, but Rails has a method on 'Enumerable' called 'index_by' which can be handy in this case: @@list = [   {     :lname =&gt; "Brown",     :email =&gt; "james@intuit.com",     :fname =&gt; "James"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   } ]@@Now you can get the unique rows as follows: @@list.index_by {|r| r[:email]}.values@@To merge the rows with the same email id. @@list.group_by{|r| r[:email]}.map do |k, v|   v.inject({}) { |r, h| r.merge(h){ |key, o, n| o || n } } end@@Custom but efficient method: @@list.inject({}) do |r, h|    (r[h[:email]] ||= {}).merge!(h){ |key, old, new| old || new }   r end.values@@||  ||[[http://stackoverflow.com:80/a/5316407 | share]]|[[http://stackoverflow.com:80/posts/5316407/edit | improve this answer]] || [[http://stackoverflow.com:80/posts/5316407/revisions | edited Mar 15 '11 at 23:56]] [[%3c%3c]]|| answered Mar 15 '11 at 18:39[[http://stackoverflow.com:80/users/163203/harish-shetty | https://www.gravatar.com/avatar/354dbc60f05bbc3ea25cdf2c14540caf?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/163203/harish-shetty | Harish Shetty]] [[%3c%3c]] 31.6k84992|| ||%0a> || ||||  || || || ||%0a> %0a> [[#5208395]]%0a> %0a> ||%0a> ||[[ | up vote]] 6 [[ | down vote]] ||In Ruby 1.9.2, @@Array#uniq@@ will accept a block paramater which it will use when comparing your objects: @@arrays.uniq { |h| h[:email] }@@||  ||[[http://stackoverflow.com:80/a/5208395 | share]]|[[http://stackoverflow.com:80/posts/5208395/edit | improve this answer]] || answered Mar 6 '11 at 3:06[[http://stackoverflow.com:80/users/190985/dan-cheail | https://www.gravatar.com/avatar/674c8e07920ebbb3a9a1b47e8b89f0fb?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/190985/dan-cheail | Dan Cheail]] [[%3c%3c]] 5,39011025|| ||%0a> || ||||  || ||shoot I'm not on ruby 1.9.2 &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:19 || || ||@AnApprentice You can use the backports gem and @@require 'backports/1.9.2/array/uniq'@@. &ndash;&nbsp;[[http://stackoverflow.com:80/users/8279/marc-andre-lafortune | Marc-Andr&eacute; Lafortune]] Mar 23 at 17:39 || ||%0a> %0a> [[#5208389]]%0a> %0a> ||%0a> ||[[ | up vote]] 5 [[ | down vote]] ||If you're putting this directly into the database, just use @@validates_uniqueness_of :email@@ in your model. See the [[http://api.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_uniqueness_of | documentation for this]].If you need to remove them from the actual hash before being used then do: @@emails = []  # This is a temporary array, not your results. The results are still in my_array my_array.delete_if do |item|   if emails.include? item[:email]     true   else     emails &lt;&lt; item[:email]     false   end end@@'''UPDATE''':This will merge the contents of duplicate entries @@merged_list = {} my_array.each do |item|   if merged_list.has_key? item[:email]     merged_list[item.email].merge! item   else     merged_list[item.email] = item   end end my_array = merged_list.collect { |k, v| v }@@||  ||[[http://stackoverflow.com:80/a/5208389 | share]]|[[http://stackoverflow.com:80/posts/5208389/edit | improve this answer]] || [[http://stackoverflow.com:80/posts/5208389/revisions | edited Mar 6 '11 at 3:37]] [[%3c%3c]]|| answered Mar 6 '11 at 3:04[[http://stackoverflow.com:80/users/211563/andrew-marshall | https://www.gravatar.com/avatar/d32a10a2f047dec1e5582e74cba6b3ec?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] [[%3c%3c]] 31k64365|| ||%0a> || ||||  || ||thanks but how would this work. I don't want to lose all the other information. I want to take the hash above and remove the duplicates while retaining fname and lname. &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:07 || ||||  ||2 || || ||So you actually want to ''merge'' the entries with the same email address? That's different than removing duplicates, which is what you asked for. &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 3:10 || || ||not merge just remove any duplicate's based on a key of email. It can be unintelligent and just take the firs brad@intuit.com and then remove the rest if any duplicates based solely on the email exists. &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:19 || ||||  ||1 || || ||That is '''exactly''' what my original code does. &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 3:21 || || ||ok my apologies. Just tried the first code snippet. It errors with "undefined method `&lt;&lt;' for {}:Hash" &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:34 ||[[ | show '''1''' more comment]] ||%0a> %0a> [[#5208460]]%0a> %0a> ||%0a> ||[[ | up vote]] 1 [[ | down vote]] ||Ok, this (delete duplicates) is what you asked for: @@a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? m : m &lt;&lt; e }@@But I think this (merge values) is what you want: @@a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o || n }; m) : m &lt;&lt; e }@@Perhaps I'm stretching the one-liner idea a bit unreasonably, so with different formatting and a test case: @@Aiko:so ross$ cat mergedups require 'pp' a = [{:fname=&gt;"James", :lname=&gt;"Brown", :email=&gt;"james@intuit.com"},      {:fname=&gt;nil,     :lname=&gt;nil,     :email=&gt;"brad@intuit.com"},      {:fname=&gt;"Brad",  :lname=&gt;"Smith", :email=&gt;"brad@intuit.com"},      {:fname=&gt;nil,     :lname=&gt;nil,     :email=&gt;"brad@intuit.com"},      {:fname=&gt;"Brad",  :lname=&gt;"Smith", :email=&gt;"brad@intuit.com"},      {:fname=&gt;"Brad",  :lname=&gt;"Smith", :email=&gt;"brad@intuit.com"}] pp(   a.sort_by { |e| e[:email] }.inject([]) do |m,e|     m.last.nil? ? [e] :       m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o || n }; m) :         m &lt;&lt; e   end ) Aiko:so ross$ ruby mergedups [{:email=&gt;"brad@intuit.com", :fname=&gt;"Brad", :lname=&gt;"Smith"},  {:email=&gt;"james@intuit.com", :fname=&gt;"James", :lname=&gt;"Brown"}]@@||  ||[[http://stackoverflow.com:80/a/5208460 | share]]|[[http://stackoverflow.com:80/posts/5208460/edit | improve this answer]] || [[http://stackoverflow.com:80/posts/5208460/revisions | edited Mar 6 '11 at 16:51]] [[%3c%3c]]|| answered Mar 6 '11 at 3:26[[http://stackoverflow.com:80/users/140740/digitalross | https://www.gravatar.com/avatar/bf6eddcd47c263a1a5d31bdb4f7b6424?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] [[%3c%3c]] 68.4k489153|| ||%0a> || ||||  || ||That's snazzy only wish I knew how it did what it's doing. For extra points a little commenting &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:38 || || ||What exactly does @@.inject([])@@ do? &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 3:38 || ||||  ||2 || || ||@AnApprentice: sure, no problem. @@#inject@@ is a method in @@Enumerable@@ which is implemented by @@Array@@. In this form, it loops over the array yielding a ''memo'' and ''element'' object to the block, which returns the ''memo'' for the next iteration. So, after the sort_by, I just compare each hash with the last one in the latest memo and merge the fields if the emails match, otherwise I just tack the element onto the end of the memo, which ultimately is what @@inject@@ will return as the value of the expression. &ndash;&nbsp;[[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] Mar 6 '11 at 3:41 || ||||  ||2 || || ||@Andrew, the @@[]@@ is the initial value of the ''memo'' object that my expression is accumulating. Ultimately it will be the new array with the merged hash elements and will be returned by the last "iteration" of @@#inject@@. @@#inject@@ isn't hugely different from plain old @@#each@@, it just returns a value and also accumulates that value for you by yielding it with each element to the block as it iterates. &ndash;&nbsp;[[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] Mar 6 '11 at 3:43 || ||||  ||1 || || ||[[http://www.ruby-doc.org/core-1.8.7/classes/Enumerable.html#M001155 | ruby-doc.org/core-1.8.7/classes/Enumerable.html#M001155]] &ndash;&nbsp;[[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] Mar 6 '11 at 3:47 ||[[ | show '''1''' more comment]] ||%0a> %0a> [[#new-answer]]%0a> %0a> !! Your Answer%0a> %0a> &nbsp;draft saveddraft discarded%0a> %0a> !!! Sign up or [[http://stackoverflow.com:80/users/login?returnurl=/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails#new-answer | log in]]%0a> %0a> Sign up using Google%0a> %0a> Sign up using Facebook%0a> %0a> Sign up using Stack Exchange%0a> %0a> !!! Post as a guest%0a> %0a> ||%0a> || ||NameEmail required, but not shown ||%0a> %0a> !!! Post as a guest%0a> %0a> ||%0a> || ||NameEmail required, but not shown ||%0a> %0a>  [[http://stackoverflow.com:80/# | discard]]%0a> %0a> By posting your answer, you agree to the [[http://stackexchange.com/legal/privacy-policy | privacy policy]] and [[http://stackexchange.com/legal/terms-of-service | terms of service]].%0a> %0a> !! Not the answer you're looking for? Browse other questions tagged [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails | ruby-on-rails]] [[http://stackoverflow.com:80/questions/tagged/ruby | ruby]] [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails-3 | ruby-on-rails-3]] or [[http://stackoverflow.com:80/questions/ask | ask your own question]].%0a> %0a> tagged%0a> %0a> [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails | ruby-on-rails]]&nbsp;&times;&nbsp;123400 \\%0a> [[http://stackoverflow.com:80/questions/tagged/ruby | ruby]]&nbsp;&times;&nbsp;78056 \\%0a> [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails-3 | ruby-on-rails-3]]&nbsp;&times;&nbsp;45711 \\%0a> %0a> ||%0a> ||asked ||'''2 years ago''' ||%0a> ||viewed ||'''3168 times''' ||%0a> ||active ||'''[[http://stackoverflow.com:80/?lastactivity | 11 months ago]]''' ||%0a> %0a> !!!! Linked%0a> %0a> [[http://stackoverflow.com:80/q/15589509 | ]] [[http://stackoverflow.com:80/questions/15589509/delete-duplicates-from-a-hash | Delete duplicates from a hash?]]%0a> %0a> !!!! Related%0a> %0a> [[http://stackoverflow.com:80/q/5213343 | ]] [[http://stackoverflow.com:80/questions/5213343/ruby-rails-given-two-hashes-how-to-exchange-items | ruby/rails - Given two Hashes how to exchange items?]][[http://stackoverflow.com:80/q/6227600 | 51]] [[http://stackoverflow.com:80/questions/6227600/how-to-remove-a-key-from-hash-and-get-the-remaining-hash-in-ruby-rails | How to remove a key from Hash and get the remaining hash in Ruby/Rails?]][[http://stackoverflow.com:80/q/7194113 | 1]] [[http://stackoverflow.com:80/questions/7194113/ruby-on-rails-3-active-record-how-to-address-data | ruby on rails 3, active record, how to address data]][[http://stackoverflow.com:80/q/9619387 | 2]] [[http://stackoverflow.com:80/questions/9619387/ruby-on-rails-commands-and-conventions-what-are-they | Ruby on Rails commands and conventions - what are they?]][[http://stackoverflow.com:80/q/10994342 | ]] [[http://stackoverflow.com:80/questions/10994342/how-do-i-use-another-value-of-a-key-in-a-hash-if-the-first-one-doesnt-exist-li | How do I use another value of a key in a hash if the first one doesn't exist, like some type of fallback in ruby/rails?]][[http://stackoverflow.com:80/q/12283923 | ]] [[http://stackoverflow.com:80/questions/12283923/ruby-rails-hash-issue | Ruby Rails Hash Issue]][[http://stackoverflow.com:80/q/12770018 | 2]] [[http://stackoverflow.com:80/questions/12770018/ruby-on-rails-how-to-validate-nested-attributes-on-certain-condition | Ruby on Rails: How to validate nested attributes on certain condition?]][[http://stackoverflow.com:80/q/16878656 | 1]] [[http://stackoverflow.com:80/questions/16878656/how-do-i-merge-two-lists-and-remove-duplicates-in-ruby-rails | How do I merge two lists, and remove duplicates, in ruby/rails?]][[http://stackoverflow.com:80/q/17062023 | 1]] [[http://stackoverflow.com:80/questions/17062023/how-to-display-custom-error-message-for-activerecordjdbcerror-in-ruby-on-rails | How to display custom error message for ActiveRecord::JDBCError in Ruby on Rails?]][[http://stackoverflow.com:80/q/17323596 | 2]] [[http://stackoverflow.com:80/questions/17323596/sorting-hash-with-custom-comparator-in-ruby | Sorting hash with custom comparator in ruby]][[http://stackoverflow.com:80/feeds/question/5208344 | question feed]]http://stackoverflow.com:80/posts/5208344/ivc/de08lang-rb[[http://stackoverflow.com:80/about | about]] [[http://stackoverflow.com:80/help | help]] [[http://stackoverflow.com:80/help/badges | badges]] [[http://blog.stackexchange.com?blb=1 | blog]] [[http://chat.stackoverflow.com | chat]] [[http://data.stackexchange.com | data]] [[http://stackexchange.com/legal | legal]] [[http://stackexchange.com/legal/privacy-policy | privacy policy]] [[http://stackexchange.com/about/hiring | jobs]] [[http://engine.adzerk.net/r?e=eyJhdiI6NDE0LCJhdCI6MjAsImNtIjo5NTQsImNoIjoxMTc4LCJjciI6Mjc3NiwiZG0iOjQsImZjIjoyODYyLCJmbCI6Mjc1MSwibnciOjIyLCJydiI6MCwicHIiOjExNSwic3QiOjAsInVyIjoiaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2Fib3V0L2NvbnRhY3QiLCJyZSI6MX0&s=hRods5B22XvRBwWIwtIMekcyNF8 | advertising info]] [[ | mobile]] '''[[http://stackoverflow.com:80/contact | contact us]]''' '''[[http://meta.stackoverflow.com | feedback]]'''%0a> %0a> ||%0a> ||!Technology ||||||!Life / Arts ||!Culture / Recreation ||!Science ||!Other ||%0a> ||# [[http://stackoverflow.com | Stack Overflow]] # [[http://serverfault.com | Server Fault]] # [[http://superuser.com | Super User]] # [[http://webapps.stackexchange.com | Web Applications]] # [[http://askubuntu.com | Ask Ubuntu]] # [[http://webmasters.stackexchange.com | Webmasters]] # [[http://gamedev.stackexchange.com | Game Development]] # [[http://tex.stackexchange.com | TeX - LaTeX]] ||# [[http://programmers.stackexchange.com | Programmers]] # [[http://unix.stackexchange.com | Unix &amp; Linux]] # [[http://apple.stackexchange.com | Ask Different (Apple)]] # [[http://wordpress.stackexchange.com | WordPress Answers]] # [[http://gis.stackexchange.com | Geographic Information Systems]] # [[http://electronics.stackexchange.com | Electrical Engineering]] # [[http://android.stackexchange.com | Android Enthusiasts]] # [[http://security.stackexchange.com | IT Security]] ||# [[http://dba.stackexchange.com | Database Administrators]] # [[http://drupal.stackexchange.com | Drupal Answers]] # [[http://sharepoint.stackexchange.com | SharePoint]] # [[http://ux.stackexchange.com | User Experience]] # [[http://mathematica.stackexchange.com | Mathematica]] # [[http://stackexchange.com/sites#technology |  more (13) ]] ||# [[http://photo.stackexchange.com | Photography]] # [[http://scifi.stackexchange.com | Science Fiction &amp; Fantasy]] # [[http://cooking.stackexchange.com | Seasoned Advice (cooking)]] # [[http://diy.stackexchange.com | Home Improvement]] # [[http://stackexchange.com/sites#lifearts |  more (13) ]] ||# [[http://english.stackexchange.com | English Language &amp; Usage]] # [[http://skeptics.stackexchange.com | Skeptics]] # [[http://judaism.stackexchange.com | Mi Yodeya (Judaism)]] # [[http://travel.stackexchange.com | Travel]] # [[http://christianity.stackexchange.com | Christianity]] # [[http://gaming.stackexchange.com | Arqade (gaming)]] # [[http://bicycles.stackexchange.com | Bicycles]] # [[http://rpg.stackexchange.com | Role-playing Games]] # [[http://stackexchange.com/sites#culturerecreation |  more (21) ]] ||# [[http://math.stackexchange.com | Mathematics]] # [[http://stats.stackexchange.com | Cross Validated (stats)]] # [[http://cstheory.stackexchange.com | Theoretical Computer Science]] # [[http://physics.stackexchange.com | Physics]] # [[http://mathoverflow.net | MathOverflow]] # [[http://stackexchange.com/sites#science |  more (7) ]] ||# [[http://stackapps.com | Stack Apps]] # [[http://meta.stackoverflow.com | Meta Stack Overflow]] # [[http://area51.stackexchange.com | Area 51]] # [[http://careers.stackoverflow.com | Stack Overflow Careers]] ||%0a> %0a>  site design / logo &copy; 2013 stack exchange inc; user contributions licensed under [[http://creativecommons.org/licenses/by-sa/3.0/ | cc-wiki]] with [[http://blog.stackoverflow.com/2009/06/attribution-required/ | attribution required]][[http://creativecommons.org/licenses/by-sa/3.0/ | ]] rev 2013.7.23.884 Stack Overflow works best with JavaScript enabledhttp://pixel.quantserve.com/pixel/p-c1rF4kxgLUzNc.gif%0a> %0a132,134c106,108%0a%3c Summary: a few ways to removing records with duplicate values residing in a hash, or merging records with duplicate values%0a%3c Tags: saved page, ruby, hash, duplicate values%0a%3c (:tags-hide saved page, ruby, hash, duplicate values:)%0a---%0a> Summary: a short description of the page%0a> Tags: saved page%0a> (:tags-hide saved page:)%0a137,139c111,113%0a%3c Parent: (Technology.)Ruby%0a%3c includeme: [[Technology.Ruby]]%0a%3c Categories:[[!Articles]], [[!HowTos]]%0a---%0a> Parent:%0a> includeme:%0a> Categories:[[!Articles]]%0a
host:1374654889=71.63.215.130
author:1374653349=tamara
diff:1374653349:1374653349:=1,117d0%0a%3c (:nolinkwikiwords:)%0a%3c [[http://stackexchange.com | Stack Exchange]]  [[http://stackoverflow.com:80/users/login?returnurl=/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | sign up]] | [[http://stackoverflow.com:80/users/login?returnurl=/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | log in]] | [[http://careers.stackoverflow.com | careers 2.0]] |   \\%0a%3c [[http://stackoverflow.com:80/ |  Stack Overflow ]]%0a%3c %0a%3c * [[http://stackoverflow.com:80/questions | Questions]]%0a%3c * [[http://stackoverflow.com:80/tags | Tags]]%0a%3c * [[http://stackoverflow.com:80/about | Tour]]%0a%3c * [[http://stackoverflow.com:80/users | Users]]%0a%3c %0a%3c * [[http://stackoverflow.com:80/questions/ask | Ask Question]]%0a%3c %0a%3c  [[http://stackoverflow.com:80/about | Tell me more]] [[ | &times;]] Stack Overflow is a question and answer site for professional and enthusiast programmers. It's 100%25 free, no registration required.%0a%3c %0a%3c ! [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails | How to remove duplicates in a hash in Ruby on Rails?]]%0a%3c %0a%3c ||%0a%3c ||[[ | up vote]] 4 [[ | down vote]] [[http://stackoverflow.com:80/# | favorite]]'''1''' ||I have a hash like so: @@[   {     :lname =&gt; "Brown",     :email =&gt; "james@intuit.com",     :fname =&gt; "James"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   } ]@@What I would like to learn how to do is how to remove a record if it is duplicate. Meaning, see how there are several "brad@intuit.com" how can I remove the duplicate records, meaning remove all the others that have an email of "brad@intuit.com".... Making email the key not the other fields?[[http://stackoverflow.com:80/questions/tagged/ruby-on-rails | ruby-on-rails]] [[http://stackoverflow.com:80/questions/tagged/ruby | ruby]] [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails-3 | ruby-on-rails-3]]||  ||[[http://stackoverflow.com:80/q/5208344 | share]]|[[http://stackoverflow.com:80/posts/5208344/edit | improve this question]] || [[http://stackoverflow.com:80/posts/5208344/revisions | edited Mar 15 '11 at 22:22]][[http://stackoverflow.com:80/users/38765/andrew-grimm | https://www.gravatar.com/avatar/01bbb59a1c3ef9960f25a97afe7e920f?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/38765/andrew-grimm | Andrew Grimm]] [[%3c%3c]] 17.6k950113||asked Mar 6 '11 at 2:54[[http://stackoverflow.com:80/users/149080/anapprentice | https://www.gravatar.com/avatar/685eca46bfebf9233cc276b415a74ddb?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] [[%3c%3c]] 11.3k31177419 || ||%0a%3c || ||||  ||||  ||2 || || ||Is the a pure Ruby hash or a hash that represents data actually in the database (say, via ActiveRecord)? &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 2:56 || ||||  ||1 || || ||why not put validates_uniqueness_of the email field? that way even if you get duplicate stuff in your params, it won't be saved. also put the necessary error catching when saving fails. &ndash;&nbsp;[[http://stackoverflow.com:80/users/334545/corroded | corroded]] Mar 6 '11 at 2:56 || || ||It's being created based on a CSV list, where users can input emails to invite friends &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 2:57 || || ||@Corroded, can't do that bec I need to take the input and then parse and display the output to the user. The above is after the input has been parsed. I just need to take it to the next level by removing duplicates. &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 2:58 || ||%0a%3c %0a%3c [[#tab-top]]%0a%3c %0a%3c !! 4 Answers%0a%3c %0a%3c [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails?answertab=active#tab-top | active]] [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails?answertab=oldest#tab-top | oldest]] [[http://stackoverflow.com:80/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails?answertab=votes#tab-top | votes]][[#5316407]]%0a%3c %0a%3c ||%0a%3c ||[[ | up vote]] 6 [[ | down vote]] accepted ||I know this is an old thread, but Rails has a method on 'Enumerable' called 'index_by' which can be handy in this case: @@list = [   {     :lname =&gt; "Brown",     :email =&gt; "james@intuit.com",     :fname =&gt; "James"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   },   {     :lname =&gt; "Smith",     :email =&gt; "brad@intuit.com",     :fname =&gt; "Brad"   },   {     :lname =&gt; nil,     :email =&gt; "brad@intuit.com",     :fname =&gt; nil   } ]@@Now you can get the unique rows as follows: @@list.index_by {|r| r[:email]}.values@@To merge the rows with the same email id. @@list.group_by{|r| r[:email]}.map do |k, v|   v.inject({}) { |r, h| r.merge(h){ |key, o, n| o || n } } end@@Custom but efficient method: @@list.inject({}) do |r, h|    (r[h[:email]] ||= {}).merge!(h){ |key, old, new| old || new }   r end.values@@||  ||[[http://stackoverflow.com:80/a/5316407 | share]]|[[http://stackoverflow.com:80/posts/5316407/edit | improve this answer]] || [[http://stackoverflow.com:80/posts/5316407/revisions | edited Mar 15 '11 at 23:56]] [[%3c%3c]]|| answered Mar 15 '11 at 18:39[[http://stackoverflow.com:80/users/163203/harish-shetty | https://www.gravatar.com/avatar/354dbc60f05bbc3ea25cdf2c14540caf?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/163203/harish-shetty | Harish Shetty]] [[%3c%3c]] 31.6k84992|| ||%0a%3c || ||||  || || || ||%0a%3c %0a%3c [[#5208395]]%0a%3c %0a%3c ||%0a%3c ||[[ | up vote]] 6 [[ | down vote]] ||In Ruby 1.9.2, @@Array#uniq@@ will accept a block paramater which it will use when comparing your objects: @@arrays.uniq { |h| h[:email] }@@||  ||[[http://stackoverflow.com:80/a/5208395 | share]]|[[http://stackoverflow.com:80/posts/5208395/edit | improve this answer]] || answered Mar 6 '11 at 3:06[[http://stackoverflow.com:80/users/190985/dan-cheail | https://www.gravatar.com/avatar/674c8e07920ebbb3a9a1b47e8b89f0fb?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/190985/dan-cheail | Dan Cheail]] [[%3c%3c]] 5,39011025|| ||%0a%3c || ||||  || ||shoot I'm not on ruby 1.9.2 &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:19 || || ||@AnApprentice You can use the backports gem and @@require 'backports/1.9.2/array/uniq'@@. &ndash;&nbsp;[[http://stackoverflow.com:80/users/8279/marc-andre-lafortune | Marc-Andr&eacute; Lafortune]] Mar 23 at 17:39 || ||%0a%3c %0a%3c [[#5208389]]%0a%3c %0a%3c ||%0a%3c ||[[ | up vote]] 5 [[ | down vote]] ||If you're putting this directly into the database, just use @@validates_uniqueness_of :email@@ in your model. See the [[http://api.rubyonrails.org/classes/ActiveRecord/Validations/ClassMethods.html#method-i-validates_uniqueness_of | documentation for this]].If you need to remove them from the actual hash before being used then do: @@emails = []  # This is a temporary array, not your results. The results are still in my_array my_array.delete_if do |item|   if emails.include? item[:email]     true   else     emails &lt;&lt; item[:email]     false   end end@@'''UPDATE''':This will merge the contents of duplicate entries @@merged_list = {} my_array.each do |item|   if merged_list.has_key? item[:email]     merged_list[item.email].merge! item   else     merged_list[item.email] = item   end end my_array = merged_list.collect { |k, v| v }@@||  ||[[http://stackoverflow.com:80/a/5208389 | share]]|[[http://stackoverflow.com:80/posts/5208389/edit | improve this answer]] || [[http://stackoverflow.com:80/posts/5208389/revisions | edited Mar 6 '11 at 3:37]] [[%3c%3c]]|| answered Mar 6 '11 at 3:04[[http://stackoverflow.com:80/users/211563/andrew-marshall | https://www.gravatar.com/avatar/d32a10a2f047dec1e5582e74cba6b3ec?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] [[%3c%3c]] 31k64365|| ||%0a%3c || ||||  || ||thanks but how would this work. I don't want to lose all the other information. I want to take the hash above and remove the duplicates while retaining fname and lname. &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:07 || ||||  ||2 || || ||So you actually want to ''merge'' the entries with the same email address? That's different than removing duplicates, which is what you asked for. &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 3:10 || || ||not merge just remove any duplicate's based on a key of email. It can be unintelligent and just take the firs brad@intuit.com and then remove the rest if any duplicates based solely on the email exists. &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:19 || ||||  ||1 || || ||That is '''exactly''' what my original code does. &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 3:21 || || ||ok my apologies. Just tried the first code snippet. It errors with "undefined method `&lt;&lt;' for {}:Hash" &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:34 ||[[ | show '''1''' more comment]] ||%0a%3c %0a%3c [[#5208460]]%0a%3c %0a%3c ||%0a%3c ||[[ | up vote]] 1 [[ | down vote]] ||Ok, this (delete duplicates) is what you asked for: @@a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? m : m &lt;&lt; e }@@But I think this (merge values) is what you want: @@a.sort_by { |e| e[:email] }.inject([]) { |m,e| m.last.nil? ? [e] : m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o || n }; m) : m &lt;&lt; e }@@Perhaps I'm stretching the one-liner idea a bit unreasonably, so with different formatting and a test case: @@Aiko:so ross$ cat mergedups require 'pp' a = [{:fname=&gt;"James", :lname=&gt;"Brown", :email=&gt;"james@intuit.com"},      {:fname=&gt;nil,     :lname=&gt;nil,     :email=&gt;"brad@intuit.com"},      {:fname=&gt;"Brad",  :lname=&gt;"Smith", :email=&gt;"brad@intuit.com"},      {:fname=&gt;nil,     :lname=&gt;nil,     :email=&gt;"brad@intuit.com"},      {:fname=&gt;"Brad",  :lname=&gt;"Smith", :email=&gt;"brad@intuit.com"},      {:fname=&gt;"Brad",  :lname=&gt;"Smith", :email=&gt;"brad@intuit.com"}] pp(   a.sort_by { |e| e[:email] }.inject([]) do |m,e|     m.last.nil? ? [e] :       m.last[:email] == e[:email] ? (m.last.merge!(e) { |k,o,n| o || n }; m) :         m &lt;&lt; e   end ) Aiko:so ross$ ruby mergedups [{:email=&gt;"brad@intuit.com", :fname=&gt;"Brad", :lname=&gt;"Smith"},  {:email=&gt;"james@intuit.com", :fname=&gt;"James", :lname=&gt;"Brown"}]@@||  ||[[http://stackoverflow.com:80/a/5208460 | share]]|[[http://stackoverflow.com:80/posts/5208460/edit | improve this answer]] || [[http://stackoverflow.com:80/posts/5208460/revisions | edited Mar 6 '11 at 16:51]] [[%3c%3c]]|| answered Mar 6 '11 at 3:26[[http://stackoverflow.com:80/users/140740/digitalross | https://www.gravatar.com/avatar/bf6eddcd47c263a1a5d31bdb4f7b6424?s=32&d=identicon&r=PG]][[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] [[%3c%3c]] 68.4k489153|| ||%0a%3c || ||||  || ||That's snazzy only wish I knew how it did what it's doing. For extra points a little commenting &ndash;&nbsp;[[http://stackoverflow.com:80/users/149080/anapprentice | AnApprentice]] Mar 6 '11 at 3:38 || || ||What exactly does @@.inject([])@@ do? &ndash;&nbsp;[[http://stackoverflow.com:80/users/211563/andrew-marshall | Andrew Marshall]] Mar 6 '11 at 3:38 || ||||  ||2 || || ||@AnApprentice: sure, no problem. @@#inject@@ is a method in @@Enumerable@@ which is implemented by @@Array@@. In this form, it loops over the array yielding a ''memo'' and ''element'' object to the block, which returns the ''memo'' for the next iteration. So, after the sort_by, I just compare each hash with the last one in the latest memo and merge the fields if the emails match, otherwise I just tack the element onto the end of the memo, which ultimately is what @@inject@@ will return as the value of the expression. &ndash;&nbsp;[[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] Mar 6 '11 at 3:41 || ||||  ||2 || || ||@Andrew, the @@[]@@ is the initial value of the ''memo'' object that my expression is accumulating. Ultimately it will be the new array with the merged hash elements and will be returned by the last "iteration" of @@#inject@@. @@#inject@@ isn't hugely different from plain old @@#each@@, it just returns a value and also accumulates that value for you by yielding it with each element to the block as it iterates. &ndash;&nbsp;[[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] Mar 6 '11 at 3:43 || ||||  ||1 || || ||[[http://www.ruby-doc.org/core-1.8.7/classes/Enumerable.html#M001155 | ruby-doc.org/core-1.8.7/classes/Enumerable.html#M001155]] &ndash;&nbsp;[[http://stackoverflow.com:80/users/140740/digitalross | DigitalRoss]] Mar 6 '11 at 3:47 ||[[ | show '''1''' more comment]] ||%0a%3c %0a%3c [[#new-answer]]%0a%3c %0a%3c !! Your Answer%0a%3c %0a%3c &nbsp;draft saveddraft discarded%0a%3c %0a%3c !!! Sign up or [[http://stackoverflow.com:80/users/login?returnurl=/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails#new-answer | log in]]%0a%3c %0a%3c Sign up using Google%0a%3c %0a%3c Sign up using Facebook%0a%3c %0a%3c Sign up using Stack Exchange%0a%3c %0a%3c !!! Post as a guest%0a%3c %0a%3c ||%0a%3c || ||NameEmail required, but not shown ||%0a%3c %0a%3c !!! Post as a guest%0a%3c %0a%3c ||%0a%3c || ||NameEmail required, but not shown ||%0a%3c %0a%3c  [[http://stackoverflow.com:80/# | discard]]%0a%3c %0a%3c By posting your answer, you agree to the [[http://stackexchange.com/legal/privacy-policy | privacy policy]] and [[http://stackexchange.com/legal/terms-of-service | terms of service]].%0a%3c %0a%3c !! Not the answer you're looking for? Browse other questions tagged [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails | ruby-on-rails]] [[http://stackoverflow.com:80/questions/tagged/ruby | ruby]] [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails-3 | ruby-on-rails-3]] or [[http://stackoverflow.com:80/questions/ask | ask your own question]].%0a%3c %0a%3c tagged%0a%3c %0a%3c [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails | ruby-on-rails]]&nbsp;&times;&nbsp;123400 \\%0a%3c [[http://stackoverflow.com:80/questions/tagged/ruby | ruby]]&nbsp;&times;&nbsp;78056 \\%0a%3c [[http://stackoverflow.com:80/questions/tagged/ruby-on-rails-3 | ruby-on-rails-3]]&nbsp;&times;&nbsp;45711 \\%0a%3c %0a%3c ||%0a%3c ||asked ||'''2 years ago''' ||%0a%3c ||viewed ||'''3168 times''' ||%0a%3c ||active ||'''[[http://stackoverflow.com:80/?lastactivity | 11 months ago]]''' ||%0a%3c %0a%3c !!!! Linked%0a%3c %0a%3c [[http://stackoverflow.com:80/q/15589509 | ]] [[http://stackoverflow.com:80/questions/15589509/delete-duplicates-from-a-hash | Delete duplicates from a hash?]]%0a%3c %0a%3c !!!! Related%0a%3c %0a%3c [[http://stackoverflow.com:80/q/5213343 | ]] [[http://stackoverflow.com:80/questions/5213343/ruby-rails-given-two-hashes-how-to-exchange-items | ruby/rails - Given two Hashes how to exchange items?]][[http://stackoverflow.com:80/q/6227600 | 51]] [[http://stackoverflow.com:80/questions/6227600/how-to-remove-a-key-from-hash-and-get-the-remaining-hash-in-ruby-rails | How to remove a key from Hash and get the remaining hash in Ruby/Rails?]][[http://stackoverflow.com:80/q/7194113 | 1]] [[http://stackoverflow.com:80/questions/7194113/ruby-on-rails-3-active-record-how-to-address-data | ruby on rails 3, active record, how to address data]][[http://stackoverflow.com:80/q/9619387 | 2]] [[http://stackoverflow.com:80/questions/9619387/ruby-on-rails-commands-and-conventions-what-are-they | Ruby on Rails commands and conventions - what are they?]][[http://stackoverflow.com:80/q/10994342 | ]] [[http://stackoverflow.com:80/questions/10994342/how-do-i-use-another-value-of-a-key-in-a-hash-if-the-first-one-doesnt-exist-li | How do I use another value of a key in a hash if the first one doesn't exist, like some type of fallback in ruby/rails?]][[http://stackoverflow.com:80/q/12283923 | ]] [[http://stackoverflow.com:80/questions/12283923/ruby-rails-hash-issue | Ruby Rails Hash Issue]][[http://stackoverflow.com:80/q/12770018 | 2]] [[http://stackoverflow.com:80/questions/12770018/ruby-on-rails-how-to-validate-nested-attributes-on-certain-condition | Ruby on Rails: How to validate nested attributes on certain condition?]][[http://stackoverflow.com:80/q/16878656 | 1]] [[http://stackoverflow.com:80/questions/16878656/how-do-i-merge-two-lists-and-remove-duplicates-in-ruby-rails | How do I merge two lists, and remove duplicates, in ruby/rails?]][[http://stackoverflow.com:80/q/17062023 | 1]] [[http://stackoverflow.com:80/questions/17062023/how-to-display-custom-error-message-for-activerecordjdbcerror-in-ruby-on-rails | How to display custom error message for ActiveRecord::JDBCError in Ruby on Rails?]][[http://stackoverflow.com:80/q/17323596 | 2]] [[http://stackoverflow.com:80/questions/17323596/sorting-hash-with-custom-comparator-in-ruby | Sorting hash with custom comparator in ruby]][[http://stackoverflow.com:80/feeds/question/5208344 | question feed]]http://stackoverflow.com:80/posts/5208344/ivc/de08lang-rb[[http://stackoverflow.com:80/about | about]] [[http://stackoverflow.com:80/help | help]] [[http://stackoverflow.com:80/help/badges | badges]] [[http://blog.stackexchange.com?blb=1 | blog]] [[http://chat.stackoverflow.com | chat]] [[http://data.stackexchange.com | data]] [[http://stackexchange.com/legal | legal]] [[http://stackexchange.com/legal/privacy-policy | privacy policy]] [[http://stackexchange.com/about/hiring | jobs]] [[http://engine.adzerk.net/r?e=eyJhdiI6NDE0LCJhdCI6MjAsImNtIjo5NTQsImNoIjoxMTc4LCJjciI6Mjc3NiwiZG0iOjQsImZjIjoyODYyLCJmbCI6Mjc1MSwibnciOjIyLCJydiI6MCwicHIiOjExNSwic3QiOjAsInVyIjoiaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2Fib3V0L2NvbnRhY3QiLCJyZSI6MX0&s=hRods5B22XvRBwWIwtIMekcyNF8 | advertising info]] [[ | mobile]] '''[[http://stackoverflow.com:80/contact | contact us]]''' '''[[http://meta.stackoverflow.com | feedback]]'''%0a%3c %0a%3c ||%0a%3c ||!Technology ||||||!Life / Arts ||!Culture / Recreation ||!Science ||!Other ||%0a%3c ||# [[http://stackoverflow.com | Stack Overflow]] # [[http://serverfault.com | Server Fault]] # [[http://superuser.com | Super User]] # [[http://webapps.stackexchange.com | Web Applications]] # [[http://askubuntu.com | Ask Ubuntu]] # [[http://webmasters.stackexchange.com | Webmasters]] # [[http://gamedev.stackexchange.com | Game Development]] # [[http://tex.stackexchange.com | TeX - LaTeX]] ||# [[http://programmers.stackexchange.com | Programmers]] # [[http://unix.stackexchange.com | Unix &amp; Linux]] # [[http://apple.stackexchange.com | Ask Different (Apple)]] # [[http://wordpress.stackexchange.com | WordPress Answers]] # [[http://gis.stackexchange.com | Geographic Information Systems]] # [[http://electronics.stackexchange.com | Electrical Engineering]] # [[http://android.stackexchange.com | Android Enthusiasts]] # [[http://security.stackexchange.com | IT Security]] ||# [[http://dba.stackexchange.com | Database Administrators]] # [[http://drupal.stackexchange.com | Drupal Answers]] # [[http://sharepoint.stackexchange.com | SharePoint]] # [[http://ux.stackexchange.com | User Experience]] # [[http://mathematica.stackexchange.com | Mathematica]] # [[http://stackexchange.com/sites#technology |  more (13) ]] ||# [[http://photo.stackexchange.com | Photography]] # [[http://scifi.stackexchange.com | Science Fiction &amp; Fantasy]] # [[http://cooking.stackexchange.com | Seasoned Advice (cooking)]] # [[http://diy.stackexchange.com | Home Improvement]] # [[http://stackexchange.com/sites#lifearts |  more (13) ]] ||# [[http://english.stackexchange.com | English Language &amp; Usage]] # [[http://skeptics.stackexchange.com | Skeptics]] # [[http://judaism.stackexchange.com | Mi Yodeya (Judaism)]] # [[http://travel.stackexchange.com | Travel]] # [[http://christianity.stackexchange.com | Christianity]] # [[http://gaming.stackexchange.com | Arqade (gaming)]] # [[http://bicycles.stackexchange.com | Bicycles]] # [[http://rpg.stackexchange.com | Role-playing Games]] # [[http://stackexchange.com/sites#culturerecreation |  more (21) ]] ||# [[http://math.stackexchange.com | Mathematics]] # [[http://stats.stackexchange.com | Cross Validated (stats)]] # [[http://cstheory.stackexchange.com | Theoretical Computer Science]] # [[http://physics.stackexchange.com | Physics]] # [[http://mathoverflow.net | MathOverflow]] # [[http://stackexchange.com/sites#science |  more (7) ]] ||# [[http://stackapps.com | Stack Apps]] # [[http://meta.stackoverflow.com | Meta Stack Overflow]] # [[http://area51.stackexchange.com | Area 51]] # [[http://careers.stackoverflow.com | Stack Overflow Careers]] ||%0a%3c %0a%3c  site design / logo &copy; 2013 stack exchange inc; user contributions licensed under [[http://creativecommons.org/licenses/by-sa/3.0/ | cc-wiki]] with [[http://blog.stackoverflow.com/2009/06/attribution-required/ | attribution required]][[http://creativecommons.org/licenses/by-sa/3.0/ | ]] rev 2013.7.23.884 Stack Overflow works best with JavaScript enabledhttp://pixel.quantserve.com/pixel/p-c1rF4kxgLUzNc.gif%0a%3c %0a%3c (:linkwikiwords:)%0a%3c %0a%3c >>comment%3c%3c%0a%3c Summary: a short description of the page%0a%3c Tags: saved page%0a%3c (:tags-hide saved page:)%0a%3c (:title How to remove duplicates in a hash in Ruby on Rails? - Stack Overflow:)%0a%3c Source: http://stackoverflow.com/questions/5208344/how-to-remove-duplicates-in-a-hash-in-ruby-on-rails%0a%3c Parent:%0a%3c includeme:%0a%3c Categories:[[!Articles]]%0a%3c >>%3c%3c%0a%3c %0a%3c Page saved at: Wed, 24 Jul 2013 03:08:41 -0500%0a%3c %0a
host:1374653349=71.63.215.130
